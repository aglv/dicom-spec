<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
      <title>B.27 Request Storage Commitment For Multiple Instances With JSON</title>
      <link rel="stylesheet" type="text/css" href="dicom.css" />
      <meta name="generator" content="DocBook XSL Stylesheets V1.78.1" />
      <link rel="home" href="PS3.18.html" title="PS3.18" />
      <link rel="up" href="chapter_B.html" title="B Examples (Informative)" />
      <link rel="prev" href="sect_B.26.html" title="B.26 WADL Method Definition of a Capabilities Description for an Origin Server Supporting Studies Search" />
      <link rel="next" href="sect_B.28.html" title="B.28 Request Storage Commitment For Multiple Instances With XML and Referenced Study and Series Instance UIDs" />
      <style type="text/css"><![CDATA[
	p { font-size: 15px; }
      ]]></style>
   </head>
   <body>
      <table xmlns="" xmlns:d="http://docbook.org/ns/docbook" width="100%">
         <tr>
            <th colspan="1" align="center" rowspan="1">
               <span class="documentreleaseinformation">DICOM PS3.18 - Web Services</span>
            </th>
         </tr>
      </table>
      <div xmlns="" class="navheader">
         <table width="100%" summary="Navigation header">
            <tr>
               <th colspan="3" align="center" rowspan="1">B.27 Request Storage Commitment For Multiple Instances With JSON <a accesskey="current" href="http://dicom.nema.org/medical/dicom/current/output/chtml/part18/sect_B.27.html" shape="rect">(Current)</a>
               </th>
            </tr>
            <tr>
               <td width="20%" align="left" rowspan="1" colspan="1">
                  <a accesskey="p" href="sect_B.26.html" shape="rect">Prev</a> </td>
               <th width="60%" align="center" rowspan="1" colspan="1">B Examples (Informative)</th>
               <td width="20%" align="right" rowspan="1" colspan="1"> <a accesskey="n" href="sect_B.28.html" shape="rect">Next</a>
               </td>
            </tr>
         </table>
         <hr />
      </div>
      <div xmlns="" xmlns:d="http://docbook.org/ns/docbook" class="breadcrumbs">
         <span class="breadcrumb-link">
            <a href="PS3.18.html" shape="rect">PS3.18</a>
         </span> &gt; <span class="breadcrumb-link">
            <a href="chapter_B.html" shape="rect">Examples (Informative)</a>
         </span> &gt; <span class="breadcrumb-node">Request Storage Commitment For Multiple Instances With JSON</span>
      </div>
      <div class="section">
         <div class="titlepage">
            <div>
               <div>
                  <h2 class="title" style="clear: both">
                     <a id="sect_B.27" shape="rect"></a>B.27 Request Storage Commitment For Multiple Instances With JSON</h2>
               </div>
            </div>
         </div>
         <p>
            <a id="para_94b63513-1ba4-4650-a6cc-249870dcfce7" shape="rect"></a>This example shows the flow of messages between the user agent and the origin server for the scenario in which 1) the user agent requests storage commitment for two SOP Instances in JSON, 2) the origin server tells the user agent to check for the result of this request later, 3) the user agent checks for the result, and 4) the result provided by the origin server shows that it commits to safely store one of the Instances, while it does not commit to safely store the other Instance.</p>
         <p>
            <a id="para_b5164680-1508-40e6-aa08-a71d46587a4c" shape="rect"></a>Step 1 of this scenario involves the user agent sending a POST request for the two Instances with Transaction UID 1.1.99999.20220901 in the HTTP header:</p>
         <pre class="programlisting" xml:space="preserve">POST/radiology/commitment-requests/1.1.99999.20220901 HTTP/1.1
Host: www.hospital-stmarco
Content-Type: application/dicom+json
…
{
  "00081199": {
    "vr": "SQ",
    "Value": [{
      "00081150": {
        "vr": "UI",
        "Value": [
          "1.2.840.10008.5.1.4.1.1.2"
        ]
      },
      "00081155": {
        "vr": "UI",
        "Value": [
          "1.3.12.2.1107.5.99.3.30000012031310075961300000059"
        ]
      }
    },
    {
      "00081150": {
        "vr": "UI",
        "Value": [
          "1.2.840.10008.5.1.4.1.1.2"
        ]
      },
      "00081155": {
        "vr": "UI",
        "Value": [
          "1.3.12.2.1107.5.99.3.30000012031310075961300000060"
        ]
      }
    }]
  }
}
</pre>
         <p>
            <a id="para_ee27590a-3f7f-4081-85e2-99a2ce3cb1fd" shape="rect"></a>Here, the references to the applicable SOP Instances are in the Referenced SOP Sequence (0008,1199);
                see <a class="xref" href="chapter_J.html#table_J.1-1" title="Table J.1-1.  Storage Commitment Request Module" shape="rect">Table J.1-1</a> for the possible structures of the storage commitment request.
                The SOP Class UID of both the Instances is CT Image (for both Instances, Referenced SOP Class UID  (0008,1150) has the value 1.2.840.10008.5.1.4.1.1.2),
                and the applicable Instances are identified by their respective SOP Instance UIDs (the values of Referenced SOP Instance UID (0008,1155) are 1.3.12.2.1107.5.99.3.30000012031310075961300000059 and …00060) respectively).</p>
         <p>
            <a id="para_ac41804e-b252-4c60-ad4a-1d3e803f3733" shape="rect"></a>In step 2 the origin server returns its response to the request.
                In this scenario this is the asynchronous case where there is no immediate result (return code 202 Accepted),
                and where the server also notifies the user agent that it ought to wait at least 300 seconds before making a follow-up request for the result;
                the synchronous response case would skip steps 2 and 3, and would continue at step 4.</p>
         <pre class="programlisting" xml:space="preserve">HTTP/1.1 202 Accepted
Retry-After: 300
…
</pre>
         <p>
            <a id="para_71860260-2e1c-4c4d-9dc3-65f98167dc29" shape="rect"></a>In step 3, after waiting the suggested period of time, the user agent GETs the status of the request using the same transaction UID as given in the original request:</p>
         <pre class="programlisting" xml:space="preserve">GET /radiology/commitment-requests/1.1.99999.20220901 HTTP/1.1
Host: www.hospital-stmarco
Content-Type: application/dicom+json
…
</pre>
         <p>
            <a id="para_ff2a79dc-af95-443e-8fdd-d7c0618af46f" shape="rect"></a>Step 4 of this scenario involves the origin server returning the result of the storage commitment request.
                In this case it is the response to the result check as shown in step 3.
                Note that in case the server initially responds to the POST request of step 1 with the HTTP response status code 200 (the synchronous case) the same result would be returned:</p>
         <pre class="programlisting" xml:space="preserve">HTTP/1.1 200 OK
Content-Length: 842
Content-Type: application/dicom+json; charset=utf-8

{
  "00081199": {
    "vr": "SQ",
    "Value": [{
      "00081150": {
        "vr": "UI",
        "Value": [
          "1.2.840.10008.5.1.4.1.1.2"
        ]
      },
      "00081155": {
        "vr": "UI",
        "Value": [
          "1.3.12.2.1107.5.99.3.30000012031310075961300000059"
        ]
      }
    }]
  },
  "00081198": {
    "vr": "SQ",
    "Value": [{
      "00081150": {
        "vr": "UI",
        "Value": [
          "1.2.840.10008.5.1.4.1.1.2"
        ]
      },
      "00081155": {
        "vr": "UI",
        "Value": [
          "1.3.12.2.1107.5.99.3.30000012031310075961300000060"
        ]
      },
      "00081197": {
        "vr": "US",
        "Value": [ 274 ]
      }
    }]
  }
}
</pre>
         <p>
            <a id="para_539c5f85-398f-4b34-ba83-96abd0322204" shape="rect"></a>The origin server provided 274 as value of the Failure Reason (0008,1197).
                This is 0112H and means "No such object Instance" (see <a href="../part03/sect_C.14.html#sect_C.14.1.1" class="olink" shape="rect">Section C.14.1.1 in <span class="olinkdocname">PS3.3</span>
            </a>).
                Apparently, the SOP Instance identified by SOP Instance UID 1.3.12.2.1107.5.99.3.30000012031310075961300000060 is not on the origin server.</p>
      </div>
      <div class="navfooter">
         <hr />
         <table width="100%" summary="Navigation footer">
            <tr>
               <td width="40%" align="left" rowspan="1" colspan="1">
                  <a accesskey="p" href="sect_B.26.html" shape="rect">Prev</a> </td>
               <td width="20%" align="center" rowspan="1" colspan="1">
                  <a accesskey="u" href="chapter_B.html" shape="rect">Up</a>
               </td>
               <td width="40%" align="right" rowspan="1" colspan="1"> <a accesskey="n" href="sect_B.28.html" shape="rect">Next</a>
               </td>
            </tr>
            <tr>
               <td width="40%" align="left" valign="top" rowspan="1" colspan="1">B.26 WADL Method Definition of a Capabilities Description for an Origin Server Supporting Studies Search </td>
               <td width="20%" align="center" rowspan="1" colspan="1">
                  <a accesskey="h" href="PS3.18.html" shape="rect">Home</a>
               </td>
               <td width="40%" align="right" valign="top" rowspan="1" colspan="1"> B.28 Request Storage Commitment For Multiple Instances With XML and Referenced Study and Series Instance UIDs</td>
            </tr>
         </table>
      </div>
      <table xmlns="" xmlns:d="http://docbook.org/ns/docbook" width="100%">
         <tr>
            <th colspan="1" align="center" rowspan="1">
               <span class="documentreleaseinformation">DICOM PS3.18 - Web Services</span>
            </th>
         </tr>
      </table>
   </body>
</html>

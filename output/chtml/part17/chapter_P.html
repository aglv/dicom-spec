<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
      <title>P Transforms and Mappings (Informative)</title>
      <link rel="stylesheet" type="text/css" href="dicom.css" />
      <meta name="generator" content="DocBook XSL Stylesheets V1.78.1" />
      <link rel="home" href="PS3.17.html" title="PS3.17" />
      <link rel="up" href="PS3.17.html" title="PS3.17" />
      <link rel="prev" href="sect_O.6.html" title="O.6 Spatial Fiducials" />
      <link rel="next" href="chapter_Q.html" title="Q Breast Imaging Report (Informative)" />
      <style type="text/css"><![CDATA[
	p { font-size: 15px; }
      ]]></style>
   </head>
   <body>
      <table xmlns="" xmlns:d="http://docbook.org/ns/docbook" width="100%">
         <tr>
            <th colspan="1" align="center" rowspan="1">
               <span class="documentreleaseinformation">DICOM PS3.17 2024a - Explanatory Information</span>
            </th>
         </tr>
      </table>
      <div xmlns="" class="navheader">
         <table width="100%" summary="Navigation header">
            <tr>
               <th colspan="3" align="center" rowspan="1">P Transforms and Mappings (Informative) <a accesskey="current" href="http://dicom.nema.org/medical/dicom/current/output/chtml/part17/chapter_P.html" shape="rect">(Current)</a>
               </th>
            </tr>
            <tr>
               <td width="20%" align="left" rowspan="1" colspan="1">
                  <a accesskey="p" href="sect_O.6.html" shape="rect">Prev</a> </td>
               <th width="60%" align="center" rowspan="1" colspan="1"> </th>
               <td width="20%" align="right" rowspan="1" colspan="1"> <a accesskey="n" href="chapter_Q.html" shape="rect">Next</a>
               </td>
            </tr>
         </table>
         <hr />
      </div>
      <div xmlns="" xmlns:d="http://docbook.org/ns/docbook" class="breadcrumbs">
         <span class="breadcrumb-link">
            <a href="PS3.17.html" shape="rect">PS3.17</a>
         </span> &gt; <span class="breadcrumb-node">Transforms and Mappings (Informative)</span>
      </div>
      <div class="chapter">
         <div class="titlepage">
            <div>
               <div>
                  <h1 class="title">
                     <a id="chapter_P" shape="rect"></a>P Transforms and Mappings (Informative)</h1>
               </div>
            </div>
         </div>
         <p>
            <a id="para_670596cb-f4d3-4e60-97c0-736af01bf938" shape="rect"></a>The Affine Transform Matrix is of the following form.</p>
         <div class="equation">
            <a id="equation_P-1" shape="rect"></a>
            <p class="title">
               <strong>Equation P-1. </strong>
            </p>
            <div class="equation-contents">
               <object type="image/svg+xml" data="figures/chapter_P_image_1.svg" style="">
                  <param name="src" value="image_1.svg" />
               </object>
            </div>
         </div>
         <br class="equation-break" clear="none" />
         <p>
            <a id="para_b233ef9a-22d1-4406-8b43-4beceaa37f7d" shape="rect"></a>This matrix requires the bottom row to be [0 0 0 1] to preserve the homogeneous coordinates.</p>
         <p>
            <a id="para_1f2ebdbe-2b53-48e1-a91c-b7a67009ac4d" shape="rect"></a>The matrix can be of type: RIGID, RIGID_SCALE and AFFINE. These different types represent different conditions on the allowable values for the matrix elements.</p>
         <div class="itemizedlist">
            <ul class="itemizedlist" style="list-style-type: disc; ">
               <li class="listitem">
                  <p>
                     <a id="para_6c6e6d6c-7d4b-4c95-bf64-e901ceaeed06" shape="rect"></a>RIGID:</p>
                  <p>
                     <a id="para_071bc96a-3afb-4367-8061-24cbb565ce6a" shape="rect"></a>This transform requires the matrix obey orthonormal transformation properties:</p>
                  <div class="equation">
                     <a id="equation_P-2" shape="rect"></a>
                     <p class="title">
                        <strong>Equation P-2. </strong>
                     </p>
                     <div class="equation-contents">
                        <object type="image/svg+xml" data="figures/chapter_P_image_2.svg" style="">
                           <param name="src" value="image_2.svg" />
                        </object>
                     </div>
                  </div>
                  <br class="equation-break" clear="none" />
                  <p>
                     <a id="para_8dea406d-701b-4802-b130-8ad4f3704e39" shape="rect"></a>for all combinations of j = 1,2,3 and k = 1,2,3 where δ = 1 for i = j and zero otherwise.</p>
                  <p>
                     <a id="para_d5575a92-e3c2-445a-9663-50de4d08caf3" shape="rect"></a>The expansion into non-matrix equations is:</p>
                  <div class="itemizedlist">
                     <ul class="itemizedlist" style="list-style-type: none; ">
                        <li class="listitem" style="list-style-type: none">
                           <p>
                              <a id="para_3ff83794-e2cd-4d0c-9d3a-ab3567136523" shape="rect"></a>M<sub>11</sub> M<sub>11</sub> + M<sub>21</sub> M<sub>21</sub> + M<sub>31</sub> M<sub>31</sub> = 1 where j = 1, k = 1</p>
                        </li>
                        <li class="listitem" style="list-style-type: none">
                           <p>
                              <a id="para_8cf66d40-efc9-4f13-ada0-fbfd997a27a4" shape="rect"></a>M<sub>11</sub> M<sub>12</sub> + M<sub>21</sub> M<sub>22</sub> + M<sub>31</sub> M<sub>32</sub> = 0 where j = 1, k = 2</p>
                        </li>
                        <li class="listitem" style="list-style-type: none">
                           <p>
                              <a id="para_d1729781-c9dd-4be2-9050-e594f3d52f85" shape="rect"></a>M<sub>11</sub> M<sub>13</sub> + M<sub>21</sub> M<sub>23</sub> + M<sub>31</sub> M<sub>33</sub> = 0 where j = 1, k = 3</p>
                        </li>
                        <li class="listitem" style="list-style-type: none">
                           <p>
                              <a id="para_51525257-4a8e-403b-bacc-8be883b5477e" shape="rect"></a>M<sub>12</sub> M<sub>11</sub> + M<sub>22</sub> M<sub>21</sub> + M<sub>32</sub> M<sub>31</sub> = 0 where j = 2, k = 1</p>
                        </li>
                        <li class="listitem" style="list-style-type: none">
                           <p>
                              <a id="para_6a14b46c-79dc-41bd-8214-97f5dcd6d684" shape="rect"></a>M<sub>12</sub> M<sub>12</sub> + M<sub>22</sub> M<sub>22</sub> + M<sub>32</sub> M<sub>32</sub> = 1 where j = 2, k = 2</p>
                        </li>
                        <li class="listitem" style="list-style-type: none">
                           <p>
                              <a id="para_35028eb1-4a17-4eda-a667-8e85ab91085e" shape="rect"></a>M<sub>12</sub> M<sub>13</sub> + M<sub>22</sub> M<sub>23</sub> + M<sub>32</sub> M<sub>33</sub> = 0 where j = 2, k = 3</p>
                        </li>
                        <li class="listitem" style="list-style-type: none">
                           <p>
                              <a id="para_b8424287-3b95-4d2c-9026-d08752e6f382" shape="rect"></a>M<sub>13</sub> M<sub>11</sub> + M<sub>23</sub> M<sub>21</sub> + M<sub>33</sub> M<sub>31</sub> = 0 where j = 3, k = 1</p>
                        </li>
                        <li class="listitem" style="list-style-type: none">
                           <p>
                              <a id="para_a9a763a3-ea1c-4314-8792-181beec76ce7" shape="rect"></a>M<sub>13</sub> M<sub>12</sub> + M<sub>23</sub> M<sub>22</sub> + M<sub>33</sub> M<sub>32</sub> = 0 where j = 3, k = 2</p>
                        </li>
                        <li class="listitem" style="list-style-type: none">
                           <p>
                              <a id="para_59555c52-2301-4940-bcef-affe55485446" shape="rect"></a>M<sub>13</sub> M<sub>13</sub> + M<sub>23</sub> M<sub>23</sub> + M<sub>33</sub> M<sub>33</sub> = 1 where j = 3, k = 3</p>
                        </li>
                     </ul>
                  </div>
                  <p>
                     <a id="para_27e9ee1c-4f00-43f2-aeb4-42e57e0d3398" shape="rect"></a>The Frame of Reference Transformation Matrix <sup>A</sup>M<sub>B</sub> describes how to transform a point (B<sub>x</sub>,B<sub>y</sub>,B<sub>z</sub>) with respect to RCS<sub>B</sub> into (A<sub>x</sub>,A<sub>y</sub>,A<sub>z</sub>) with respect to RCS<sub>A</sub>.</p>
                  <div class="equation">
                     <a id="equation_P-3" shape="rect"></a>
                     <p class="title">
                        <strong>Equation P-3. </strong>
                     </p>
                     <div class="equation-contents">
                        <object type="image/svg+xml" data="figures/chapter_P_image_3.svg" style="">
                           <param name="src" value="image_3.svg" />
                        </object>
                     </div>
                  </div>
                  <br class="equation-break" clear="none" />
                  <p>
                     <a id="para_989decdb-443f-449a-a2bb-e6191c382517" shape="rect"></a>The matrix above consists of two parts: a rotation and translation as shown below;</p>
                  <p>
                     <a id="para_d7c9c5be-41a6-451d-b886-7af3e50372c5" shape="rect"></a>Rotation:</p>
                  <div class="equation">
                     <a id="equation_P-4" shape="rect"></a>
                     <p class="title">
                        <strong>Equation P-4. </strong>
                     </p>
                     <div class="equation-contents">
                        <object type="image/svg+xml" data="figures/chapter_P_image_4.svg" style="">
                           <param name="src" value="image_4.svg" />
                        </object>
                     </div>
                  </div>
                  <br class="equation-break" clear="none" />
                  <p>
                     <a id="para_2de1d0a8-f2c7-41ca-842e-2ee89694a7e5" shape="rect"></a>Translation:</p>
                  <div class="equation">
                     <a id="equation_P-5" shape="rect"></a>
                     <p class="title">
                        <strong>Equation P-5. </strong>
                     </p>
                     <div class="equation-contents">
                        <object type="image/svg+xml" data="figures/chapter_P_image_5.svg" style="">
                           <param name="src" value="image_5.svg" />
                        </object>
                     </div>
                  </div>
                  <br class="equation-break" clear="none" />
                  <p>
                     <a id="para_703f2ee4-d216-41de-aa64-a8eac5d32241" shape="rect"></a>The first column [M<sub>11</sub>,M<sub>21</sub>,M<sub>31</sub> ] are the direction cosines (projection) of the X-axis of RCS<sub>B</sub> with respect to RCS<sub>A</sub>
                    <span class="italic">.</span> The second column [M<sub>12</sub>,M<sub>22</sub>,M<sub>32</sub>] are the direction cosines (projection) of the Y-axis of RCS<sub>B</sub> with respect to RCS<sub>A.</sub> The third column [M<sub>13</sub>,M<sub>23</sub>,M<sub>33</sub>] are the direction cosines (projection) of the Z-axis of RCS<sub>B</sub> with respect to RCS<sub>A.</sub> The fourth column [T<sub>1</sub>,T<sub>2</sub>,T<sub>3</sub>] is the origin of RCS<sub>B</sub> with respect to RCS<sub>A</sub>.</p>
                  <p>
                     <a id="para_4f03347e-b5f3-4914-a2e8-c4b1bc9cc86b" shape="rect"></a>There are three degrees of freedom representing rotation, and three degrees of freedom representing translation, giving a total of six degrees of freedom.</p>
               </li>
               <li class="listitem">
                  <p>
                     <a id="para_1f369bcf-5dd2-46a7-96cf-8abbef5f6d26" shape="rect"></a>RIGID_SCALE</p>
                  <p>
                     <a id="para_69058a7d-2eec-4d08-a913-87ed4fec37d0" shape="rect"></a>The following constraint applies:</p>
                  <div class="equation">
                     <a id="equation_P-6" shape="rect"></a>
                     <p class="title">
                        <strong>Equation P-6. </strong>
                     </p>
                     <div class="equation-contents">
                        <object type="image/svg+xml" data="figures/chapter_P_image_6.svg" style="">
                           <param name="src" value="image_6.svg" />
                        </object>
                     </div>
                  </div>
                  <br class="equation-break" clear="none" />
                  <p>
                     <a id="para_f51a84e1-dc65-43db-8df4-e4fe5fe13fe7" shape="rect"></a>for all combinations of j = 1,2,3 and k = 1,2,3 where δ = 1 for i=j and zero otherwise.</p>
                  <p>
                     <a id="para_60ceb5f0-c067-4f6d-9eef-19ba7a69c5cb" shape="rect"></a>The expansion into non-matrix equations is:</p>
                  <div class="itemizedlist">
                     <ul class="itemizedlist" style="list-style-type: none; ">
                        <li class="listitem" style="list-style-type: none">
                           <p>
                              <a id="para_b34aec98-7ba8-4032-be61-e9353d5825d4" shape="rect"></a>M<sub>11</sub> M<sub>11</sub> + M<sub>21</sub> M<sub>21</sub> + M<sub>31</sub> M<sub>31</sub> = S<sub>1</sub>
                              <sup>2</sup> where j = 1, k = 1</p>
                        </li>
                        <li class="listitem" style="list-style-type: none">
                           <p>
                              <a id="para_24796021-690f-4eda-be53-9b7ed1552f48" shape="rect"></a>M<sub>11</sub> M<sub>12</sub> + M<sub>21</sub> M<sub>22</sub> + M<sub>31</sub> M<sub>32</sub> = 0 where j = 1, k = 2</p>
                        </li>
                        <li class="listitem" style="list-style-type: none">
                           <p>
                              <a id="para_8dbeae68-405e-4692-9240-69ec2bd9c612" shape="rect"></a>M<sub>11</sub> M<sub>13</sub> + M<sub>21</sub> M<sub>23</sub> + M<sub>31</sub> M<sub>33</sub> = 0 where j = 1, k = 3</p>
                        </li>
                        <li class="listitem" style="list-style-type: none">
                           <p>
                              <a id="para_f28ff772-6feb-4670-8ae6-2c5f5ca86931" shape="rect"></a>M<sub>12</sub> M<sub>11</sub> + M<sub>22</sub> M<sub>21</sub> + M<sub>32</sub> M<sub>31</sub> = 0 where j = 2, k = 1</p>
                        </li>
                        <li class="listitem" style="list-style-type: none">
                           <p>
                              <a id="para_bb249dd0-b482-4671-b0af-f61cac52c410" shape="rect"></a>M<sub>12</sub> M<sub>12</sub> + M<sub>22</sub> M<sub>22</sub> + M<sub>32</sub> M<sub>32</sub> = S<sub>2</sub>
                              <sup>2</sup> where j = 2, k = 2</p>
                        </li>
                        <li class="listitem" style="list-style-type: none">
                           <p>
                              <a id="para_05b00488-71b6-4b9d-8b29-3b3e53367b69" shape="rect"></a>M<sub>12</sub> M<sub>13</sub> + M<sub>22</sub> M<sub>23</sub> + M<sub>32</sub> M<sub>33</sub> = 0 where j = 2, k = 3</p>
                        </li>
                        <li class="listitem" style="list-style-type: none">
                           <p>
                              <a id="para_4a487e0c-bc16-4b2f-b5e0-425dabbf9067" shape="rect"></a>M<sub>13</sub> M<sub>11</sub> + M<sub>23</sub> M<sub>21</sub> + M<sub>33</sub> M<sub>31</sub> = 0 where j = 3, k = 1</p>
                        </li>
                        <li class="listitem" style="list-style-type: none">
                           <p>
                              <a id="para_88ea27a4-3239-468c-b544-5bad973f0def" shape="rect"></a>M<sub>13</sub> M<sub>12</sub> + M<sub>23</sub> M<sub>22</sub> + M<sub>33</sub> M<sub>32</sub> = 0 where j = 3, k = 2</p>
                        </li>
                        <li class="listitem" style="list-style-type: none">
                           <p>
                              <a id="para_562099a1-09b8-4cb7-9dda-ebe0106388b0" shape="rect"></a>M<sub>13</sub> M<sub>13</sub> + M<sub>23</sub> M<sub>23</sub> + M<sub>33</sub> M<sub>33</sub> = S<sub>3</sub>
                              <sup>2</sup> where j = 3, k = 3</p>
                        </li>
                     </ul>
                  </div>
                  <p>
                     <a id="para_499ee8c0-9f6a-416f-b85d-752634d47c79" shape="rect"></a>The above equations show a simple way of extracting the spatial scaling parameters Sj from a given matrix. The units of S<sub>j</sub>
                    <sup>2</sup> is the RCS unit dimension of one millimeter.</p>
                  <p>
                     <a id="para_34a4f3f6-f0ac-4ccc-a3ae-077dc33a6cb1" shape="rect"></a>This type can be considered a simple extension of the type RIGID. The RIGID_SCALE is easily created by pre-multiplying a RIGID matrix by a diagonal scaling matrix as follows:</p>
                  <div class="equation">
                     <a id="equation_P-7" shape="rect"></a>
                     <p class="title">
                        <strong>Equation P-7. </strong>
                     </p>
                     <div class="equation-contents">
                        <object type="image/svg+xml" data="figures/chapter_P_image_7.svg" style="">
                           <param name="src" value="image_7.svg" />
                        </object>
                     </div>
                  </div>
                  <br class="equation-break" clear="none" />
                  <p>
                     <a id="para_74370184-30eb-45b4-88fd-8f67fd750b85" shape="rect"></a>where M<sub>RBWS</sub> is a matrix of type RIGID_SCALE and M<sub>RB</sub> is a matrix of type RIGID.</p>
               </li>
               <li class="listitem">
                  <p>
                     <a id="para_c6c52c64-9378-4efe-bbf8-f8de5117eeb8" shape="rect"></a>AFFINE:</p>
                  <p>
                     <a id="para_698f3eb9-0786-4474-97aa-631ecfd1db10" shape="rect"></a>No constraints apply to this matrix, so it contains twelve degrees of freedom. This type of Frame of Reference Transformation Matrix allows shearing in addition to rotation, translation and scaling.</p>
               </li>
            </ul>
         </div>
         <p>
            <a id="para_aafc4f91-d94a-4217-b176-90d48d810b1d" shape="rect"></a>For a RIGID type of Frame of Reference Transformation Matrix, the inverse is easily computed using the following formula (inverse of an orthonormal matrix):</p>
         <div class="equation">
            <a id="equation_P-8" shape="rect"></a>
            <p class="title">
               <strong>Equation P-8. </strong>
            </p>
            <div class="equation-contents">
               <object type="image/svg+xml" data="figures/chapter_P_image_8.svg" style="">
                  <param name="src" value="image_8.svg" />
               </object>
            </div>
         </div>
         <br class="equation-break" clear="none" />
         <p>
            <a id="para_626eb8a5-ed2f-4d02-a9a4-c5ce7eb05b72" shape="rect"></a>For RIGID_SCALE and AFFINE types of Registration Matrices, the inverse cannot be calculated using the above equation, and must be calculated using a conventional matrix inverse operation.</p>
      </div>
      <div class="navfooter">
         <hr />
         <table width="100%" summary="Navigation footer">
            <tr>
               <td width="40%" align="left" rowspan="1" colspan="1">
                  <a accesskey="p" href="sect_O.6.html" shape="rect">Prev</a> </td>
               <td width="20%" align="center" rowspan="1" colspan="1"> </td>
               <td width="40%" align="right" rowspan="1" colspan="1"> <a accesskey="n" href="chapter_Q.html" shape="rect">Next</a>
               </td>
            </tr>
            <tr>
               <td width="40%" align="left" valign="top" rowspan="1" colspan="1">O.6 Spatial Fiducials </td>
               <td width="20%" align="center" rowspan="1" colspan="1">
                  <a accesskey="h" href="PS3.17.html" shape="rect">Home</a>
               </td>
               <td width="40%" align="right" valign="top" rowspan="1" colspan="1"> Q Breast Imaging Report (Informative)</td>
            </tr>
         </table>
      </div>
      <table xmlns="" xmlns:d="http://docbook.org/ns/docbook" width="100%">
         <tr>
            <th colspan="1" align="center" rowspan="1">
               <span class="documentreleaseinformation">DICOM PS3.17 2024a - Explanatory Information</span>
            </th>
         </tr>
      </table>
   </body>
</html>

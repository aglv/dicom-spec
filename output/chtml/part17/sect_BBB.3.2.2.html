<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
      <title>BBB.3.2.2 Transactions and Message Flow</title>
      <link rel="stylesheet" type="text/css" href="dicom.css" />
      <meta name="generator" content="DocBook XSL Stylesheets V1.78.1" />
      <link rel="home" href="PS3.17.html" title="PS3.17" />
      <link rel="up" href="sect_BBB.3.2.html" title="BBB.3.2 Treatment Delivery Normal Flow - External Verification" />
      <link rel="prev" href="sect_BBB.3.2.html" title="BBB.3.2 Treatment Delivery Normal Flow - External Verification" />
      <link rel="next" href="sect_BBB.3.3.html" title="BBB.3.3 Treatment-delivery With External Verification - Override Or Additional Info Required" />
      <style type="text/css"><![CDATA[
	p { font-size: 15px; }
      ]]></style>
   </head>
   <body>
      <table xmlns="" xmlns:d="http://docbook.org/ns/docbook" width="100%">
         <tr>
            <th colspan="1" align="center" rowspan="1">
               <span class="documentreleaseinformation">DICOM PS3.17 2024b - Explanatory Information</span>
            </th>
         </tr>
      </table>
      <div xmlns="" class="navheader">
         <table width="100%" summary="Navigation header">
            <tr>
               <th colspan="3" align="center" rowspan="1">BBB.3.2.2 Transactions and Message Flow <a accesskey="current" href="http://dicom.nema.org/medical/dicom/current/output/chtml/part17/sect_BBB.3.2.2.html" shape="rect">(Current)</a>
               </th>
            </tr>
            <tr>
               <td width="20%" align="left" rowspan="1" colspan="1">
                  <a accesskey="p" href="sect_BBB.3.2.html" shape="rect">Prev</a> </td>
               <th width="60%" align="center" rowspan="1" colspan="1">BBB.3.2 Treatment Delivery Normal Flow - External Verification</th>
               <td width="20%" align="right" rowspan="1" colspan="1"> <a accesskey="n" href="sect_BBB.3.3.html" shape="rect">Next</a>
               </td>
            </tr>
         </table>
         <hr />
      </div>
      <div xmlns="" xmlns:d="http://docbook.org/ns/docbook" class="breadcrumbs">
         <span class="breadcrumb-link">
            <a href="PS3.17.html" shape="rect">PS3.17</a>
         </span> &gt; <span class="breadcrumb-link">
            <a href="chapter_BBB.html" shape="rect">Unified Procedure Step in Radiotherapy (Informative)</a>
         </span> &gt; <span class="breadcrumb-link">
            <a href="sect_BBB.3.html" shape="rect">Use Cases</a>
         </span> &gt; <span class="breadcrumb-link">
            <a href="sect_BBB.3.2.html" shape="rect">Treatment Delivery Normal Flow - External Verification</a>
         </span> &gt; <span class="breadcrumb-node">Transactions and Message Flow</span>
      </div>
      <div class="section">
         <div class="titlepage">
            <div>
               <div>
                  <h4 class="title">
                     <a id="sect_BBB.3.2.2" shape="rect"></a>BBB.3.2.2 Transactions and Message Flow</h4>
               </div>
            </div>
         </div>
         <p>
            <a id="para_deb2918e-d8d4-4bf8-9ed4-16d1c80a16c9" shape="rect"></a>This section describes in detail the additional interactions illustrated in <a class="xref" href="sect_BBB.3.2.2.html#figure_BBB.3.2.1-1" title="Figure BBB.3.2.1-1. Treatment Delivery Normal Flow - External Verification Message Sequence" shape="rect">Figure BBB.3.2.1-1</a>.</p>
         <p>
            <a id="para_4a68dc35-8be0-4e75-a0fd-114a66194255" shape="rect"></a>After the TDS has retrieved the necessary treatment SOP Instances (Step 7), the following step is performed:</p>
         <p>
            <a id="para_863a69d8-5242-48d0-b2fe-da2a88da93df" shape="rect"></a>7a. Communicate UPS and Required Delivery Data to MPV</p>
         <p>
            <a id="para_bb77c18c-36ad-444b-aa42-6e8d9c4bec99" shape="rect"></a>The MPV must receive information about the procedure to be performed, and any other data required in order to carry out its role. This communication typically occurs outside the DICOM Standard, since the TMS and MPV are tightly coupled (and may be the same physical device). In cases where standardized network communication of these parameters is required, this could be achieved using DICOM storage of RT Plan and RT Delivery Instruction SOP Instances, or alternatively by use of the UPS Push SOP Class.</p>
         <p>
            <a id="para_27c7a4b8-0fb3-49f6-b639-10d82505671a" shape="rect"></a>After the User has initiated the treatment session on the TDS console (Step 8), the following steps are then performed:</p>
         <p>
            <a id="para_62a550c0-eefa-4c95-8233-bcf8dcdb415a" shape="rect"></a>8a. 'Deliver Beam x' on TDS console</p>
         <p>
            <a id="para_f04df3ee-4685-47e3-b4fd-3271a9c84b94" shape="rect"></a>In some implementations, parameter verification for each beam may be initiated manually by the User (as shown in this example). In other approaches, the TDS may initiate these verifications automatically.</p>
         <p>
            <a id="para_cb06516c-950e-4d38-a938-929f8ecf4757" shape="rect"></a>8b. Create RT Conventional Machine Verification Instance</p>
         <p>
            <a id="para_63b85531-1418-4993-a91f-1539d801d0d7" shape="rect"></a>The TDS creates a new RT Conventional Machine Verification instance on the MPV prior to beam parameter verification of the first beam to be delivered. This is conveyed using the N-CREATE primitive of the RT Conventional Machine Verification SOP Class.</p>
         <p>
            <a id="para_2c3a90a5-1a60-47cb-a722-cf959a9fd8c9" shape="rect"></a>
                        </p>
         <div class="figure">
            <a id="figure_BBB.3.2.1-1" shape="rect"></a>
            <div class="figure-contents">
               <div class="mediaobject">
                  <img src="figures/PS3.17_BBB.3.2.1-1.svg" alt="Treatment Delivery Normal Flow - External Verification Message Sequence" />
               </div>
            </div>
            <p class="title">
               <strong>Figure BBB.3.2.1-1. Treatment Delivery Normal Flow - External Verification Message Sequence</strong>
            </p>
         </div>
         <p>
            <br class="figure-break" clear="none" />
                    </p>
         <p>
            <a id="para_07cd3898-3539-4cf2-817e-5ce6fc9e549a" shape="rect"></a>After the TDS has signaled the UPS current Referenced Beam Number and completion percentage for a given beam (9), the following sequence of steps is performed:</p>
         <p>
            <a id="para_943bf5c9-5a97-48f0-9c5c-d18fc8b254e4" shape="rect"></a>9a. Set 'Beam x' RT Conventional Machine Verification Instance</p>
         <p>
            <a id="para_8f799178-533b-4873-957f-0b89d6be0899" shape="rect"></a>The TDS sets the RT Conventional Machine Verification SOP Instance to transfer the necessary verification parameters. This is conveyed using the N-SET primitive of the RT Conventional Machine Verification SOP Class. The Referenced Beam Number (300C,0006) Attribute is used to specify the beam to be delivered. It is the responsibility of the SCU to keep track of the verification parameters such that the complete list of required Attributes can be specified within the top-level sequence items.</p>
         <p>
            <a id="para_ffe40504-2071-4994-a069-184ffb07b9fe" shape="rect"></a>9b. Initiate Verification</p>
         <p>
            <a id="para_9c9f9247-b56d-4cd1-8a54-91b63c9a8ef6" shape="rect"></a>The TDS sets the RT Conventional Machine Verification SOP Instance to indicate that the TDS is ready for external verification to occur. This is conveyed using the N-ACTION primitive of the RT Conventional Machine Verification SOP Class.</p>
         <p>
            <a id="para_9a67d680-2ed6-4aeb-8011-279f7d16d73f" shape="rect"></a>9c. Verify Machine Parameters</p>
         <p>
            <a id="para_2d160522-ea45-45dd-bd38-c5f2e9e7392b" shape="rect"></a>The MPV then attempts to verify the treatment parameters for 'Beam x'. The MPV sends one or more N-EVENT-REPORT signals to the TDS during the verification process. The permissible event types for these signals in this context are 'Pending' (zero or more times, not shown in this use case), and 'Done' when the verification is complete (successful or otherwise).</p>
         <p>
            <a id="para_32ebb4b9-9836-43b5-9d16-58bae2d69659" shape="rect"></a>9d. Get RT Conventional Machine Verification (optional step)</p>
         <p>
            <a id="para_5a31002c-822d-4603-8049-487ccb630427" shape="rect"></a>The TDS may then request Attributes of the RT Conventional Machine Verification instance. This is conveyed using the N-GET primitive of the RT Conventional Machine Verification SOP Class. If verification has occurred normally and the N-EVENT-REPORT contained a Treatment Verification Status of VERIFIED (this use case), then this step is not necessary unless the TDS wishes to record additional parameters associated with the verification process.</p>
         <p>
            <a id="para_b08ae340-b457-4ee1-a9eb-2e9e61164399" shape="rect"></a>The TDS then delivers the therapeutic radiation. In the current use case, it is assumed that the radiation completes normally, delivering the entire scheduled fraction. Other use cases, such as voluntary interruption by the User, or interruption by the TDS or MPV, are not described here. If the delivery requires an override of additional information, a different message flow occurs. This is illustrated in the use case described in the next section.</p>
         <p>
            <a id="para_c2f2c679-1081-4267-b9bf-95bb978d77af" shape="rect"></a>9e. Store 'Beam x' RT Beams Treatment Record to Archive</p>
         <p>
            <a id="para_f9b6a21b-aef7-4739-a803-dfca1e2ca67c" shape="rect"></a>The TDS stores an RT Beams Treatment Record to the Archive (or potentially the TMS as described in <a class="xref" href="sect_BBB.3.html#sect_BBB.3.1.2" title="BBB.3.1.2 Transactions and Message Flow" shape="rect">Section BBB.3.1.2</a> Transactions and Message Flow). The RT Beams Treatment Record is therefore not stored in Step 11 for the external verification case (since it has already been stored in the step on a per-beam basis).</p>
         <p>
            <a id="para_f0e15c4d-67c4-45a5-af71-b7c94640a61c" shape="rect"></a>For each subsequent beam in the sequence of beams being delivered, steps 8a (optional), 9, 9a, 9b, 9c, 9d (optional), and 9e are then repeated, i.e., N-SET, N-ACTION, and N-GET operations are performed on the same instance of the RT Conventional Machine Verification SOP Class, which persists throughout the beam session.</p>
         <p>
            <a id="para_6d10bd7a-96b9-4e8e-bac0-bf5b5a764d02" shape="rect"></a>9f. Delete RT Conventional Machine Verification Instance</p>
         <p>
            <a id="para_9e156238-7ed4-4e01-8a41-1434061855d2" shape="rect"></a>When all beams have been processed, the TDS deletes the RT Conventional Machine Verification SOP Instance to indicate to the MPV that verification is no longer required. This is conveyed using the N-DELETE primitive of the RT Conventional Machine Verification SOP Class.</p>
      </div>
      <div class="navfooter">
         <hr />
         <table width="100%" summary="Navigation footer">
            <tr>
               <td width="40%" align="left" rowspan="1" colspan="1">
                  <a accesskey="p" href="sect_BBB.3.2.html" shape="rect">Prev</a> </td>
               <td width="20%" align="center" rowspan="1" colspan="1">
                  <a accesskey="u" href="sect_BBB.3.2.html" shape="rect">Up</a>
               </td>
               <td width="40%" align="right" rowspan="1" colspan="1"> <a accesskey="n" href="sect_BBB.3.3.html" shape="rect">Next</a>
               </td>
            </tr>
            <tr>
               <td width="40%" align="left" valign="top" rowspan="1" colspan="1">BBB.3.2 Treatment Delivery Normal Flow - External Verification </td>
               <td width="20%" align="center" rowspan="1" colspan="1">
                  <a accesskey="h" href="PS3.17.html" shape="rect">Home</a>
               </td>
               <td width="40%" align="right" valign="top" rowspan="1" colspan="1"> BBB.3.3 Treatment-delivery With External Verification - Override Or Additional Info Required</td>
            </tr>
         </table>
      </div>
      <table xmlns="" xmlns:d="http://docbook.org/ns/docbook" width="100%">
         <tr>
            <th colspan="1" align="center" rowspan="1">
               <span class="documentreleaseinformation">DICOM PS3.17 2024b - Explanatory Information</span>
            </th>
         </tr>
      </table>
   </body>
</html>

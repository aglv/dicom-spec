<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
      <title>BBB.3 Use Cases</title>
      <link rel="stylesheet" type="text/css" href="dicom.css" />
      <meta name="generator" content="DocBook XSL Stylesheets V1.78.1" />
      <link rel="home" href="PS3.17.html" title="PS3.17" />
      <link rel="up" href="chapter_BBB.html" title="BBB Unified Procedure Step in Radiotherapy (Informative)" />
      <link rel="prev" href="sect_BBB.2.html" title="BBB.2 Use Case Actors" />
      <link rel="next" href="sect_BBB.3.2.html" title="BBB.3.2 Treatment Delivery Normal Flow - External Verification" />
      <style type="text/css"><![CDATA[
	p { font-size: 15px; }
      ]]></style>
   </head>
   <body>
      <table xmlns="" xmlns:d="http://docbook.org/ns/docbook" width="100%">
         <tr>
            <th colspan="1" align="center" rowspan="1">
               <span class="documentreleaseinformation">DICOM PS3.17 2024a - Explanatory Information</span>
            </th>
         </tr>
      </table>
      <div xmlns="" class="navheader">
         <table width="100%" summary="Navigation header">
            <tr>
               <th colspan="3" align="center" rowspan="1">BBB.3 Use Cases <a accesskey="current" href="http://dicom.nema.org/medical/dicom/current/output/chtml/part17/sect_BBB.3.html" shape="rect">(Current)</a>
               </th>
            </tr>
            <tr>
               <td width="20%" align="left" rowspan="1" colspan="1">
                  <a accesskey="p" href="sect_BBB.2.html" shape="rect">Prev</a> </td>
               <th width="60%" align="center" rowspan="1" colspan="1">BBB Unified Procedure Step in Radiotherapy (Informative)</th>
               <td width="20%" align="right" rowspan="1" colspan="1"> <a accesskey="n" href="sect_BBB.3.2.html" shape="rect">Next</a>
               </td>
            </tr>
         </table>
         <hr />
      </div>
      <div xmlns="" xmlns:d="http://docbook.org/ns/docbook" class="breadcrumbs">
         <span class="breadcrumb-link">
            <a href="PS3.17.html" shape="rect">PS3.17</a>
         </span> &gt; <span class="breadcrumb-link">
            <a href="chapter_BBB.html" shape="rect">Unified Procedure Step in Radiotherapy (Informative)</a>
         </span> &gt; <span class="breadcrumb-node">Use Cases</span>
      </div>
      <div class="section">
         <div class="titlepage">
            <div>
               <div>
                  <h2 class="title" style="clear: both">
                     <a id="sect_BBB.3" shape="rect"></a>BBB.3 Use Cases</h2>
               </div>
            </div>
         </div>
         <div class="section">
            <div class="titlepage">
               <div>
                  <div>
                     <h3 class="title">
                        <a id="sect_BBB.3.1" shape="rect"></a>BBB.3.1 Treatment Delivery Normal Flow - Internal Verification</h3>
                  </div>
               </div>
            </div>
            <div class="section">
               <div class="titlepage">
                  <div>
                     <div>
                        <h4 class="title">
                           <a id="sect_BBB.3.1.1" shape="rect"></a>BBB.3.1.1 Message Sequencing</h4>
                     </div>
                  </div>
               </div>
               <p>
                  <a id="para_db878ca8-83f2-43e1-9cd4-27d71087fb95" shape="rect"></a>
                        <a class="xref" href="sect_BBB.3.html#figure_BBB.3.1.1-1" title="Figure BBB.3.1.1-1. Treatment Delivery Normal Flow - Internal Verification Message Sequence" shape="rect">Figure BBB.3.1.1-1</a> illustrates a message sequence example in the case where a treatment procedure delivery is requested and performed by a delivery device that has internal verification capability. In the example, no 'setup verification' is performed, i.e., the patient is assumed to be in the treatment position. Unified Procedure Step (UPS) is used to request delivery of a session of radiation therapy (commonly known as a "fraction") from a specialized Application Entity (a "Treatment Delivery System"). That entity performs the requested delivery, completing normally. Further examples could be constructed for discontinued, emergency (unscheduled) and interrupted treatment delivery use cases, but are not considered in this informative section (see DICOM Part 17 for generic examples).</p>
               <p>
                  <a id="para_a5762209-fdcd-42c7-b673-4c574ebb8242" shape="rect"></a>In this example the Treatment Delivery System conforms to the UPS Pull SOP Class as an SCU, and the Treatment Management System conforms to the UPS Pull SOP Class as an SCP. In alternative implementations requiring on-the-fly scheduling and notification, other UPS SOP classes could be implemented.</p>
               <p>
                  <a id="para_8f6b7a55-25b9-4704-bb76-b9727915f0fb" shape="rect"></a>Italic text in <a class="xref" href="sect_BBB.3.html#figure_BBB.3.1.1-1" title="Figure BBB.3.1.1-1. Treatment Delivery Normal Flow - Internal Verification Message Sequence" shape="rect">Figure BBB.3.1.1-1</a> denotes messages that will typically be conveyed by means other than DICOM services.</p>
            </div>
            <div class="section">
               <div class="titlepage">
                  <div>
                     <div>
                        <h4 class="title">
                           <a id="sect_BBB.3.1.2" shape="rect"></a>BBB.3.1.2 Transactions and Message Flow</h4>
                     </div>
                  </div>
               </div>
               <p>
                  <a id="para_90efe065-70f1-491c-a14f-c0979a4a30d4" shape="rect"></a>This section describes in detail the interactions illustrated in <a class="xref" href="sect_BBB.3.html#figure_BBB.3.1.1-1" title="Figure BBB.3.1.1-1. Treatment Delivery Normal Flow - Internal Verification Message Sequence" shape="rect">Figure BBB.3.1.1-1</a>.</p>
               <div class="orderedlist">
                  <ol class="orderedlist" type="1">
                     <li class="listitem">
                        <p>
                           <a id="para_0421cde7-3167-49f0-b802-be522a6b139b" shape="rect"></a>'List Procedures for Delivery' on TDS console.</p>
                        <p>
                           <a id="para_5be4e5cd-2e84-45f5-b084-2058abb589d4" shape="rect"></a>The User uses a control on the user interface of the TDS to indicate that he or she wishes to see the list of patients available for treatment.</p>
                     </li>
                     <li class="listitem">
                        <p>
                           <a id="para_7cf7e5c5-f25c-4b36-9cb0-2b894ec1a683" shape="rect"></a>Query UPS.</p>
                        <p>
                           <a id="para_9b1b3f77-f38b-4094-a3fb-52dbc29b23c7" shape="rect"></a>The TDS queries the TMS for Unified Procedure Steps (UPSs) matching its search criteria. For example, all worklist items with a Unified Procedure Step Status of "SCHEDULED", and Input Readiness State (0040,4041) of "READY". This is conveyed using the C-FIND request primitive of the UPS Pull SOP Class.</p>
                     </li>
                     <li class="listitem">
                        <p>
                           <a id="para_692810ac-38af-4fed-95aa-52d1d036a9e3" shape="rect"></a>Receive 0-n UPS.</p>
                        <p>
                           <a id="para_876c7b34-1253-44f1-a8e2-256476c9597b" shape="rect"></a>The TDS receives the set of Unified Procedure Steps (UPSs) resulting from the Query UPS message. The Receive UPS is conveyed via one or more C-FIND response primitives of the UPS Pull SOP Class. Each response (with status pending) contains the requested Attributes of a single Unified Procedure Step (UPS).</p>
                        <p>
                           <a id="para_4bd5e824-1848-4fe4-8d5a-e5eed7db0906" shape="rect"></a>The TMS returns a list of one or more UPSs based on its own knowledge of the planned tasks for the querying device. Two real-world scenarios are common in this step:</p>
                        <div class="itemizedlist">
                           <ul class="itemizedlist" style="list-style-type: disc; ">
                              <li class="listitem">
                                 <p>
                                    <a id="para_88369e9f-7d90-467f-a984-03216d367abc" shape="rect"></a>There is no TMS Console located in the treatment area, and selection of the delivery to be performed has not been made. In this case, the TMS returns a list of potentially many UPSs (for different patients), and the User picks from the list the UPS that they wish to deliver.</p>
                              </li>
                              <li class="listitem">
                                 <p>
                                    <a id="para_628bc6e5-7566-44ff-b739-e11255c7a803" shape="rect"></a>The User has direct access to the TMS in the treatment area, and has already selected the delivery to be performed on the console of the TMS, located in the treatment room area. In this case, a single UPS is returned. The TDS may either display the single item for confirmation, or proceed directly to loading the patient details.</p>
                              </li>
                           </ul>
                        </div>
                        <p>
                           <a id="para_87803211-df93-403c-9588-789d0b87e8a7" shape="rect"></a>
                                </p>
                        <div class="figure">
                           <a id="figure_BBB.3.1.1-1" shape="rect"></a>
                           <div class="figure-contents">
                              <div class="mediaobject">
                                 <img src="figures/PS3.17_BBB.3.1.1-1.svg" alt="Treatment Delivery Normal Flow - Internal Verification Message Sequence" />
                              </div>
                           </div>
                           <p class="title">
                              <strong>Figure BBB.3.1.1-1. Treatment Delivery Normal Flow - Internal Verification Message Sequence</strong>
                           </p>
                        </div>
                        <p>
                           <br class="figure-break" clear="none" />
                            </p>
                        <p>
                           <a id="para_4f5b7c1c-ee70-46cb-acf6-340b86534761" shape="rect"></a>A returned set of UPSs may have more than one UPS addressing a given treatment delivery. For example, in the case where a patient position verification is required prior to delivery, there might be a UPS with Requested Procedure Code Sequence item having a Code Value of 121708 ("RT Patient Position Acquisition, CT MV"), another UPS with a Code Value of 121714 ("RT Patient Position Registration, 3D CT general"), another UPS with a Code Value of 121722 ("RT Patient Position Adjustment"),and a fourth UPS whose Requested Procedure Code Sequence item would have a Code Value of 121726 ("RT Treatment With Internal Verification").</p>
                     </li>
                     <li class="listitem">
                        <p>
                           <a id="para_1cc608b9-c398-472b-b1f7-cb99cb36b278" shape="rect"></a>'Select Procedure' on TDS console</p>
                        <p>
                           <a id="para_d127d955-e1b5-48fa-ab5e-248bdba95889" shape="rect"></a>The User selects one of the scheduled procedures specified on the TDS console. If exactly one UPS was returned from the UPS query described above, then this step can be omitted.</p>
                     </li>
                     <li class="listitem">
                        <p>
                           <a id="para_20cbb3d0-512f-4e5f-8672-69a6d97c8fa0" shape="rect"></a>Get UPS Details and Retrieve Archive Objects</p>
                        <p>
                           <a id="para_ed050cdb-f405-43fe-a55c-8d53d7c5c314" shape="rect"></a>The TDS may request the details of one or more procedure steps. This is conveyed using the N-GET primitive of the UPS Pull SOP Class, and is required when not all necessary information can be obtained from the query response alone.</p>
                        <p>
                           <a id="para_4742d4f9-fcfe-44f3-85db-a04183be268c" shape="rect"></a>The TDS then retrieves the required SOP Classes from the Input Information Sequence of the returned UPS query response. In response to a C-MOVE Request on those objects (5a), the Archive then transmits to the TDS the SOP Instances to be used as input information during the task. These SOP Instances might include an RT Plan SOP Instance, and verification images (CT Image or RT Image). They might also include RT Beams Treatment Record SOP Instances if the Archive is used to store these SOP Instances rather than the TMS. The TDS knows of the existence and whereabouts of these SOP Instances by virtue of the fully-specified locations in the N-GET response.</p>
                        <p>
                           <a id="para_cea6fdcc-b646-481e-ab15-6fe92d04d82e" shape="rect"></a>Although the TDS could set the UPS to 'IN PROGRESS' prior to retrieving the archive instances, this example shows the archive instances being retrieved prior to the UPS being 'locked' with the N-ACTION step. This avoids the UPS being set 'IN PROGRESS' if the required instances are not available, and therefore avoids the need to schedule another (different) procedure step in this case, as required by the Unified Procedure Step State Diagram State Diagram (<a href="../part04/PS3.4.html" class="olink" shape="rect">PS3.4</a>). However, some object instances dynamically created to service performing of the UPS step should be supplied after setting the UPS 'IN PROGRESS' (see Step 7).</p>
                     </li>
                     <li class="listitem">
                        <p>
                           <a id="para_73b21851-ff67-42ea-8679-760d11c62191" shape="rect"></a>Change UPS State to IN PROGRESS</p>
                        <p>
                           <a id="para_48481aec-1ee3-4e41-bfc3-3a0f6365c4a0" shape="rect"></a>The TDS sets the UPS (which is managed by the TMS) to have the Unified Procedure Step Status of 'IN PROGRESS' upon starting work on the item. The SOP Instance UID of the UPS will normally have been obtained in the worklist item. This is conveyed using the N-ACTION primitive of the UPS Pull SOP Class with an action type "UPS Status Change". This message allows the TMS to update its worklist and permits other Performing Devices to detect that the UPS is already being worked on.</p>
                        <p>
                           <a id="para_2df40863-5c10-4a64-8b51-1466cb0d5fe4" shape="rect"></a>The UPS is updated in this step before the required dynamic SOP Instances are obtained from the TMS (see Step 7). In radiation therapy, it is desirable to signal as early as possible that a patient is about to undergo treatment, to allow the TMS to begin other activities related to the patient delivery. If the TMS implements the UPS Watch SOP Class, other systems will be able to subscribe for notifications regarding the progress of the procedure step.</p>
                     </li>
                     <li class="listitem">
                        <p>
                           <a id="para_8d3a8ce5-658d-462d-a394-dee3c30f1dbf" shape="rect"></a>Retrieve TMS Objects</p>
                        <p>
                           <a id="para_3153ba0e-d6ce-42ab-bc64-124f1728cea3" shape="rect"></a>In response to a C-MOVE Request, the TMS transmits to the TDS the RT Beams Delivery Instruction and possibly RT Treatment Summary Record SOP Instances to be used as input information during the task. These SOP Instances may be created "on-the-fly" by the TMS (since it was the TMS itself that transmitted the UIDs in the UPS). The RT Treatment Summary SOP Instance may be required by the TDS to determine the delivery context, although the UPS does specify a completion delivery (following a previous delivery interruption). RT Beams Treatment Record instances might also be retrieved from the TMS in this step if the TMS is used to manage these SOP Instances rather than the Archive.</p>
                     </li>
                     <li class="listitem">
                        <p>
                           <a id="para_0fc72d4e-e116-4774-b5c4-ec4f698bae23" shape="rect"></a>'Start Treatment Session' on TDS console</p>
                        <p>
                           <a id="para_b91935e4-3a2a-4bcb-aa50-82b366a2fd45" shape="rect"></a>The User uses a control on the user interface of the TDS to indicate that he or she wishes to commence the treatment delivery session. A Treatment Session may involve fulfillment of more than one UPS, in which case Steps 4-13 may be repeated.</p>
                     </li>
                     <li class="listitem">
                        <p>
                           <a id="para_5f45f31c-1d04-460b-b904-617b3d4aeb0f" shape="rect"></a>Set UPS Progress and Beam Number, Verify, and Deliver Radiation</p>
                        <p>
                           <a id="para_a0774cab-a2c1-4e44-90c3-0e072d2f0c5d" shape="rect"></a>For each beam, the TDS updates the UPS on the TMS just prior to starting the radiation delivery sequencing. This is conveyed using the N-SET primitive of the UPS Pull SOP Class.</p>
                        <p>
                           <a id="para_f2953b1d-a295-41a1-abd8-f2993c27c05b" shape="rect"></a>The completion percentage of the entire UPS is indicated in the Unified Procedure Step Progress Attribute. The algorithm used to calculate this completion percentage is not specified here, but should be appropriate for user interface display.</p>
                        <p>
                           <a id="para_dff26a28-8f81-45a2-8439-bf6495641f06" shape="rect"></a>The Referenced Beam Number of the beam about to be delivered is specified by encoding it as a string value in the Procedure Step Progress Description (0074,1006).</p>
                        <p>
                           <a id="para_df39fdde-e787-4349-bacd-8d5b0927bada" shape="rect"></a>The TDS then performs internal verifications to determine that the machine is ready to deliver the radiation, and then delivers the therapeutic radiation for the specified beam. In the current use case, it is assumed that the radiation completes normally, delivering the entire scheduled fraction. Other use cases, such as voluntary interruption by the User, or interruption by the TDS, will be described elsewhere.</p>
                        <p>
                           <a id="para_1155f3c6-63d2-4c7a-a3ba-ff3c935ca4cf" shape="rect"></a>If there is more than one beam to be delivered, the verification, UPS update, and radiation delivery is repeated once per beam.</p>
                        <p>
                           <a id="para_7cbd2295-24ef-4f0b-9389-d7f84bb00a34" shape="rect"></a>This example does not specify whether or not treatment should be interrupted or terminated if a UPS update operation fails. The successful transmittal of updates is not intended as a gating requirement for continuation of the delivery, but could be used as such if the TDS considers that interrupting treatment is clinically appropriate at that moment of occurrence.</p>
                     </li>
                     <li class="listitem">
                        <p>
                           <a id="para_45ee5ab0-42aa-4500-88ea-17b857bb341b" shape="rect"></a>Set UPS to Indicate Radiation Complete</p>
                        <p>
                           <a id="para_b4b8f36a-ff1a-4c2e-9c4d-edfcdf3371b3" shape="rect"></a>The TDS may then update the UPS Progress Information Sequence upon completion of the final beam (although this is not required), and set any other Attributes of interest to the SCP. This is conveyed using the N-SET primitive of the UPS Pull SOP Class.</p>
                     </li>
                     <li class="listitem">
                        <p>
                           <a id="para_3995579c-0e81-4097-ae7f-ff7b52afb8a5" shape="rect"></a>Store Results</p>
                        <p>
                           <a id="para_6838334f-463d-478b-87b4-4322c96b1eb9" shape="rect"></a>The TDS stores any generated results to the Archive. This would typically be achieved using the Storage and/or Storage Commitment Service Classes and may contain one or more RT Beams Treatment Records or RT Treatment Summary Records, RT Images (portal verification images), CT Images (3D verification images), RT Dose (reconstructed or measured data), or other relevant Composite SOP Instances. References to the results and their storage locations are associated with the UPS in the Set UPS to Final State message (below). The RT Beams Treatment Record instances might be stored to the TMS instead, if the TMS is used to manage these SOP Instances rather than the Archive.</p>
                        <p>
                           <a id="para_f37b6267-02f1-4d5e-9a0d-2b9ffb068e45" shape="rect"></a>The required SOP Instances are stored to the Archive in this step before the UPS is status is set to COMPLETED. In radiation therapy, it is desirable to ensure that the entire procedure is complete, including storage of important patient data, before indicating that the step completed successfully. For some systems, such as those using Storage Commitment, this may not be possible, in which case another service such as Instance Availability Notification (not shown here) would have to be used to notify the TMS of SOP Instance availability. For the purpose of this example, it is assumed that the storage commitment response occurs in a short time frame.</p>
                     </li>
                     <li class="listitem">
                        <p>
                           <a id="para_d5b88a45-7bc2-4a8b-8b20-e41a42e491db" shape="rect"></a>Set UPS Attributes to Meet Final State Requirements</p>
                        <p>
                           <a id="para_a454c072-8875-40b6-9bff-1d150341502d" shape="rect"></a>The TDS then updates the UPS with any further Attributes required to conform to the UPS final state requirements. Also, references to the results SOP Instances stored in Step 11 are supplied in the Output Information Sequence. This is conveyed using the N-SET primitive of the UPS Pull SOP Class.</p>
                     </li>
                     <li class="listitem">
                        <p>
                           <a id="para_34142fcb-d976-4367-a87b-da802c750e2e" shape="rect"></a>Change UPS State to COMPLETED</p>
                        <p>
                           <a id="para_3b77b469-9977-4e51-a217-ce320256c98b" shape="rect"></a>The TDS changes the Unified Procedure Step Status of the UPS to COMPLETED upon completion of the scheduled step and storage or results. This is conveyed using the N-ACTION primitive of the UPS Pull SOP Class with an action type "UPS Status Change". This message informs the TMS that the UPS is now complete.</p>
                     </li>
                     <li class="listitem">
                        <p>
                           <a id="para_55ff97b2-606e-4a70-b977-ed9b158ba262" shape="rect"></a>Indicate 'Treatment Session Completed' on TDS Console</p>
                        <p>
                           <a id="para_1b1d1e64-edb4-47cc-905a-4de136d879c2" shape="rect"></a>The TDS then signals to the User via the TDS user interface that the requested procedure has completed successfully, and all generated SOP Instances have been stored.</p>
                     </li>
                  </ol>
               </div>
            </div>
         </div>
      </div>
      <div class="navfooter">
         <hr />
         <table width="100%" summary="Navigation footer">
            <tr>
               <td width="40%" align="left" rowspan="1" colspan="1">
                  <a accesskey="p" href="sect_BBB.2.html" shape="rect">Prev</a> </td>
               <td width="20%" align="center" rowspan="1" colspan="1">
                  <a accesskey="u" href="chapter_BBB.html" shape="rect">Up</a>
               </td>
               <td width="40%" align="right" rowspan="1" colspan="1"> <a accesskey="n" href="sect_BBB.3.2.html" shape="rect">Next</a>
               </td>
            </tr>
            <tr>
               <td width="40%" align="left" valign="top" rowspan="1" colspan="1">BBB.2 Use Case Actors </td>
               <td width="20%" align="center" rowspan="1" colspan="1">
                  <a accesskey="h" href="PS3.17.html" shape="rect">Home</a>
               </td>
               <td width="40%" align="right" valign="top" rowspan="1" colspan="1"> BBB.3.2 Treatment Delivery Normal Flow - External Verification</td>
            </tr>
         </table>
      </div>
      <table xmlns="" xmlns:d="http://docbook.org/ns/docbook" width="100%">
         <tr>
            <th colspan="1" align="center" rowspan="1">
               <span class="documentreleaseinformation">DICOM PS3.17 2024a - Explanatory Information</span>
            </th>
         </tr>
      </table>
   </body>
</html>

<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
      <title>C.2.2.2 Attribute Matching</title>
      <link rel="stylesheet" type="text/css" href="dicom.css" />
      <meta name="generator" content="DocBook XSL Stylesheets V1.78.1" />
      <link rel="home" href="PS3.4.html" title="PS3.4" />
      <link rel="up" href="sect_C.2.2.html" title="C.2.2 Attributes Definition" />
      <link rel="prev" href="sect_C.2.2.html" title="C.2.2 Attributes Definition" />
      <link rel="next" href="sect_C.2.2.2.2.html" title="C.2.2.2.2 List of UID Matching" />
      <style type="text/css"><![CDATA[
	p { font-size: 15px; }
      ]]></style>
   </head>
   <body>
      <table xmlns="" xmlns:d="http://docbook.org/ns/docbook" width="100%">
         <tr>
            <th colspan="1" align="center" rowspan="1">
               <span class="documentreleaseinformation">DICOM PS3.4 2024b - Service Class Specifications</span>
            </th>
         </tr>
      </table>
      <div xmlns="" class="navheader">
         <table width="100%" summary="Navigation header">
            <tr>
               <th colspan="3" align="center" rowspan="1">C.2.2.2 Attribute Matching <a accesskey="current" href="http://dicom.nema.org/medical/dicom/current/output/chtml/part04/sect_C.2.2.2.html" shape="rect">(Current)</a>
               </th>
            </tr>
            <tr>
               <td width="20%" align="left" rowspan="1" colspan="1">
                  <a accesskey="p" href="sect_C.2.2.html" shape="rect">Prev</a> </td>
               <th width="60%" align="center" rowspan="1" colspan="1">C.2.2 Attributes Definition</th>
               <td width="20%" align="right" rowspan="1" colspan="1"> <a accesskey="n" href="sect_C.2.2.2.2.html" shape="rect">Next</a>
               </td>
            </tr>
         </table>
         <hr />
      </div>
      <div xmlns="" xmlns:d="http://docbook.org/ns/docbook" class="breadcrumbs">
         <span class="breadcrumb-link">
            <a href="PS3.4.html" shape="rect">PS3.4</a>
         </span> &gt; <span class="breadcrumb-link">
            <a href="chapter_C.html" shape="rect">Query/Retrieve Service Class (Normative)</a>
         </span> &gt; <span class="breadcrumb-link">
            <a href="sect_C.2.html" shape="rect">Query/Retrieve Information Model Definition</a>
         </span> &gt; <span class="breadcrumb-link">
            <a href="sect_C.2.2.html" shape="rect">Attributes Definition</a>
         </span> &gt; <span class="breadcrumb-node">Attribute Matching</span>
      </div>
      <div class="section">
         <div class="titlepage">
            <div>
               <div>
                  <h4 class="title">
                     <a id="sect_C.2.2.2" shape="rect"></a>C.2.2.2 Attribute Matching</h4>
               </div>
            </div>
         </div>
         <p>
            <a id="para_6b5347b0-9720-4193-a12e-79800c681d8a" shape="rect"></a>The following types of matching may be performed on Key Attributes in the Query/Retrieve Service Class:</p>
         <div class="itemizedlist">
            <ul class="itemizedlist" style="list-style-type: disc; ">
               <li class="listitem">
                  <p>
                     <a id="para_695a0b82-dbe8-4b78-aecb-fbc394e8fbfe" shape="rect"></a>Single Value Matching</p>
               </li>
               <li class="listitem">
                  <p>
                     <a id="para_f847be43-3586-4b49-b6a1-658be3a8d76a" shape="rect"></a>List of UID Matching</p>
               </li>
               <li class="listitem">
                  <p>
                     <a id="para_af77dcb9-886d-4974-a73f-77141256795c" shape="rect"></a>Universal Matching</p>
               </li>
               <li class="listitem">
                  <p>
                     <a id="para_b4a8f98b-271b-4d7c-952e-a32f2301854f" shape="rect"></a>Wild Card Matching</p>
               </li>
               <li class="listitem">
                  <p>
                     <a id="para_bd041f81-d7fd-4003-a497-f732267fd759" shape="rect"></a>Range Matching</p>
               </li>
               <li class="listitem">
                  <p>
                     <a id="para_7b153dd5-db8c-444a-af2b-2fc89a100cc1" shape="rect"></a>Sequence Matching</p>
               </li>
               <li class="listitem">
                  <p>
                     <a id="para_186a20f5-0d02-4b26-82fa-b6d7eecb1e20" shape="rect"></a>Empty Value Matching</p>
               </li>
               <li class="listitem">
                  <p>
                     <a id="para_477c8020-4cbc-4c2d-8c47-8945fce87301" shape="rect"></a>Multiple Value Matching</p>
               </li>
            </ul>
         </div>
         <p>
            <a id="para_e5984036-11d1-44ca-92cc-28091f428305" shape="rect"></a>Matching requires special characters (i.e., "*","?","-", "=", "\", and QUOTATION MARK of the Default Character Repertoire), which need not be part of the character repertoire for the VR of the Key Attributes.</p>
         <div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">
            <h3 class="title">Note</h3>
            <div class="orderedlist">
               <ol class="orderedlist" type="1">
                  <li class="listitem">
                     <p>
                        <a id="para_431a64ef-6f8a-464b-9e8f-fb8ff87a6515" shape="rect"></a>For example, the "-" character is not valid for the DA, DT and TM VRs but is used for Range Matching. The wild card characters "*" and "?" are not valid for the CS VR but are used for Wild Card Matching.</p>
                  </li>
                  <li class="listitem">
                     <p>
                        <a id="para_d026b6cf-008a-42b2-89da-14f0bb396001" shape="rect"></a>When character sets other than the Default Character Repertoire are used, then the rules in <a href="../part05/PS3.5.html" class="olink" shape="rect">PS3.5</a> apply, such as with respect to the use of the 05/12 "\" (BACKSLASH) (in ISO IR 6) or 05/12 "¥" (YEN SIGN) (in ISO IR 14).</p>
                  </li>
               </ol>
            </div>
         </div>
         <p>
            <a id="para_246393fa-0db9-43b1-9533-a1122227799c" shape="rect"></a>The total length of the Key Attribute may exceed the length as specified in the VR in <a href="../part05/PS3.5.html" class="olink" shape="rect">PS3.5</a>. The Value Multiplicity (VM) may be larger than the VM specified in <a href="../part06/PS3.6.html" class="olink" shape="rect">PS3.6</a> for the Key Attribute, as defined for particular Matching Type.</p>
         <p>
            <a id="para_82a8a72e-10bd-4d64-809d-2dde8e395f9e" shape="rect"></a>The Specific Character Set (0008,0005) Attribute may be present in the Identifier but is never matched. Rather, it specifies how other Attributes are encoded in the Request and Response Identifiers.</p>
         <p>
            <a id="para_3fc82b2e-8c3b-4739-8ebe-5b603e0f0673" shape="rect"></a>It may influence how matching of other Attributes is performed. If Specific Character Set (0008,0005) is absent, then the Default Character Repertoire shall be used. Specific Character Set (0008,0005) shall not have a zero length value.</p>
         <p>
            <a id="para_cb375a80-0fd7-4782-98b2-29f35931271e" shape="rect"></a>Specific Character Set (0008,0005) may have multiple values if escape sequences are used to switch between character repertoires within values.</p>
         <p>
            <a id="para_ff6d4d84-8d61-460d-86dc-cc6568aa2469" shape="rect"></a>If the SCP does not support the value(s) of Specific Character Set (0008,0005) in the Request Identifier, then the manner in which matching is performed is undefined and shall be specified in the Conformance Statement.</p>
         <div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">
            <h3 class="title">Note</h3>
            <div class="orderedlist">
               <ol class="orderedlist" type="1">
                  <li class="listitem">
                     <p>
                        <a id="para_442a37c4-0279-4290-8cc6-52db9bd3e905" shape="rect"></a>If an SCU sends a Request Identifier with a single byte character set not supported by the SCP, then it is likely, but not required, that the SCP will treat unrecognized characters as wild cards and match only on characters in the default repertoire, and return a response in the default repertoire.</p>
                  </li>
                  <li class="listitem">
                     <p>
                        <a id="para_ab6d4f2b-05bd-464a-badd-a5013f542530" shape="rect"></a>Some Specific Character Set values are used with multi-component group person names (e.g., single-byte, ideographic and phonetic and phonetic component groups separated by an "=" (3DH) character), which may also affect the behavior of literal string matching.</p>
                  </li>
               </ol>
            </div>
         </div>
         <p>
            <a id="para_1f9a6aae-93b6-4973-b456-b962790c75c2" shape="rect"></a>The Timezone Offset From UTC (0008,0201) Attribute may be present in the Identifier but is not matched if Timezone query adjustment is negotiated. If Timezone query adjustment is negotiated, it specifies how Attribute Values of VR of DT and TM (including related Attribute Values of VR of DA, if present) are interpreted in the Request and Response Identifiers if those values lack a specific time zone offset specification.</p>
         <div class="section">
            <div class="titlepage">
               <div>
                  <div>
                     <h5 class="title">
                        <a id="sect_C.2.2.2.1" shape="rect"></a>C.2.2.2.1 Single Value Matching</h5>
                  </div>
               </div>
            </div>
            <p>
               <a id="para_33957686-3953-4a04-b30a-6cfc1938bbf3" shape="rect"></a>If the value specified for a Key Attribute in a request is non-zero length and if it is not of VR SQ and:</p>
            <div class="orderedlist">
               <ol class="orderedlist" type="a">
                  <li class="listitem">
                     <p>
                        <a id="para_4f144eb2-7834-4b2d-a635-829ecef27cb1" shape="rect"></a>of VR of AE, CS, LO, LT, PN, SH, ST, UC, UR or UT and contains a single value with no wild card characters,
                                    and if Extended Negotiation of Empty Value Matching is successful and it does not have the value of exactly two QUOTATION MARK characters,
                                    or</p>
                  </li>
                  <li class="listitem">
                     <p>
                        <a id="para_ab1103ab-b157-43b4-9ef5-661084ad010f" shape="rect"></a>of VR of DA, TM or DT and contains a single value with no "-" and no QUOTATION MARK characters, or</p>
                  </li>
                  <li class="listitem">
                     <p>
                        <a id="para_f4240f71-7924-4850-901c-9910dcddb6c0" shape="rect"></a>of any other VR</p>
                  </li>
               </ol>
            </div>
            <p>
               <a id="para_cbd0128a-7ff8-4271-b4e7-e9c379d0a883" shape="rect"></a>then Single Value Matching shall be performed. Except for Attributes with a PN VR, only entities with values that match exactly the value specified in the request shall match. This matching is case-sensitive, i.e., sensitive to the exact encoding of the key Attribute Value in character sets where a letter may have multiple encodings (e.g., based on its case, its position in a word, or whether it is accented).</p>
            <p>
               <a id="para_16344e15-65ff-42c0-8e49-1e5a6d49a6bd" shape="rect"></a>The following subsections define specifics for certain VRs.</p>
            <div class="section">
               <div class="titlepage">
                  <div>
                     <div>
                        <h6 class="title">
                           <a id="sect_C.2.2.2.1.1" shape="rect"></a>C.2.2.2.1.1 Attributes of VR of PN</h6>
                     </div>
                  </div>
               </div>
               <p>
                  <a id="para_d18005af-0769-4870-bbec-b6aebd090adf" shape="rect"></a>For Attributes with a PN VR (e.g., Patient Name (0010,0010)), an application may perform literal matching that is either case-sensitive, or that is insensitive to some or all aspects of case, position, accent, or other character encoding variants.</p>
               <div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">
                  <h3 class="title">Note</h3>
                  <p>
                     <a id="para_1387596f-a203-4ce9-b0f7-f901a1aa8b0c" shape="rect"></a>For multi-component names, the component group delimiter "=" (3DH) may be present in the Key Attribute Value, but may give unexpected results if the SCP does not support matching on separate components but interprets the entire value literally as a single string. E.g., "Wang^XiaoDong=王^小東" may or may not match "Wang^XiaoDong" or "王^小東"; Wild Card Matching without the component group delimiter, such as "*Wang^XiaoDong*" or "*王^小東 *" may be necessary.</p>
               </div>
               <p>
                  <a id="para_ef61aabe-1c74-445e-a239-45b34a3b0d58" shape="rect"></a>If Extended Negotiation of fuzzy semantic matching rather than literal matching of PN VR is successful, not only may matching be insensitive to case, position, accent, and character encoding (including combining characters), but in addition other techniques such as phonetic matching may be applied.</p>
               <div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">
                  <h3 class="title">Note</h3>
                  <div class="orderedlist">
                     <ol class="orderedlist" type="1">
                        <li class="listitem">
                           <p>
                              <a id="para_ec2b0092-1619-43c7-9ebd-525912992a79" shape="rect"></a>Matching of PN Attributes may be accent-insensitive, as specified in the Conformance Statement. Accent-insensitive matching would successfully match, for instance, a query character "SMALL LETTER a" (06/01 in the default ISO-IR 6) with</p>
                           <div class="itemizedlist">
                              <ul class="itemizedlist" style="list-style-type: none; ">
                                 <li class="listitem" style="list-style-type: none">
                                    <p>
                                       <a id="para_62b7eb62-14e6-4413-962c-bdd2486adfe6" shape="rect"></a>"SMALL LETTER a WITH GRAVE ACCENT" (14/00 in ISO-IR 100),</p>
                                 </li>
                                 <li class="listitem" style="list-style-type: none">
                                    <p>
                                       <a id="para_7b8341f7-1d12-49b2-95a8-c054564bff1b" shape="rect"></a>"SMALL LETTER a WITH TILDE" (14/03 in ISO-IR 100),</p>
                                 </li>
                                 <li class="listitem" style="list-style-type: none">
                                    <p>
                                       <a id="para_e2a3f3ea-1776-4187-88cb-cae647081bf0" shape="rect"></a>"SMALL LETTER a WITH BREVE" (14/03 in ISO-IR 101), and</p>
                                 </li>
                                 <li class="listitem" style="list-style-type: none">
                                    <p>
                                       <a id="para_a403b931-bad2-4886-baf2-9247734f5d82" shape="rect"></a>"CAPITAL LETTER a WITH ACUTE ACCENT" (12/01 in ISO-IR 100) (if matching is also case-insensitive),</p>
                                 </li>
                              </ul>
                           </div>
                           <p>
                              <a id="para_4b4a4f14-ff27-49e4-958e-b69ed69bb2b4" shape="rect"></a>but would not match 14/00 in ISO-IR 101, which is "SMALL LETTER r WITH ACUTE ACCENT". Matching to particular bit-combinations is specific to each supported character set (note the difference in meaning of 14/00), and should be described in the Conformance Statement.</p>
                        </li>
                        <li class="listitem">
                           <p>
                              <a id="para_5ed64695-4f7d-4c04-b0cb-411ef9a4f4da" shape="rect"></a>An SCU application may elect to perform additional filtering of the responses by applying the matching rules itself. In the event that both the SCU and SCP are applying the matching rules, this process will be successful as long as literal matching is performed by both, and any additional SCU filtering is insensitive to case, position, accent, or other character encoding variants.</p>
                        </li>
                     </ol>
                  </div>
               </div>
               <p>
                  <a id="para_d0adc3ed-2fdb-481b-a58f-1ba755aed8fb" shape="rect"></a>However if fuzzy semantic matching of PN Attributes has been negotiated, matching by the SCP may result in responses that are not obviously related to the request, hence care should be taken if any additional filtering of responses is performed by the SCU. For example, if phonetic matching is performed, a query for "Swain" might well return "Swayne", or if name component order insensitive matching is performed, a query for "Smith^Mary" might well return "Mary^Smith" or "Mary Smith" or "Smith, Mary". Fuzzy semantic matching may also take into account separate single-byte, ideographic and phonetic name component groups.</p>
            </div>
            <div class="section">
               <div class="titlepage">
                  <div>
                     <div>
                        <h6 class="title">
                           <a id="sect_C.2.2.2.1.2" shape="rect"></a>C.2.2.2.1.2 Attributes of VR of AE, CS, LO, LT, PN, SH, ST, UC, UR and UT</h6>
                     </div>
                  </div>
               </div>
               <p>
                  <a id="para_d25cd1f5-2dd6-44cf-bdd6-977eb0e875e5" shape="rect"></a>The AE, LO, LT, PN, SH, ST, UC, UR and UT VRs allow the presence of wild card characters "*" and "?".
                                Wild Card Matching is also defined for CS values.
                                Single Value Matching against such characters is not supported.
                                See <a class="xref" href="sect_C.2.2.2.4.html" title="C.2.2.2.4 Wild Card Matching" shape="rect">Section C.2.2.2.4</a>.</p>
            </div>
            <div class="section">
               <div class="titlepage">
                  <div>
                     <div>
                        <h6 class="title">
                           <a id="sect_C.2.2.2.1.3" shape="rect"></a>C.2.2.2.1.3 Attributes of VR of DA, DT or TM</h6>
                     </div>
                  </div>
               </div>
               <p>
                  <a id="para_ef9427f0-57bd-468c-8bdf-c4d8889bfe64" shape="rect"></a>If the Timezone Offset From UTC (0008,0201) Attribute is present in the Identifier and Timezone query adjustment was negotiated, it shall be used to adjust values of Attributes of VR of TM (and associated Attributes of VR of DA, if present) from the local timezone to UTC. It shall also adjust values of Attributes of VR of DT that do not specify a timezone offset. The encoding and semantics of the Timezone Offset From UTC (0008,0201) Attribute shall be as defined in the SOP Common Module in <a href="../part03/PS3.3.html" class="olink" shape="rect">PS3.3</a>.</p>
               <p>
                  <a id="para_67f4294f-9468-411e-a2d6-0e34ff6f9c8f" shape="rect"></a>The manner in which matching is performed is implementation dependent and shall be specified in the Conformance Statement.</p>
               <div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">
                  <h3 class="title">Note</h3>
                  <div class="orderedlist">
                     <ol class="orderedlist" type="1">
                        <li class="listitem">
                           <p>
                              <a id="para_629ac1f2-488f-4a92-936e-af6c87465617" shape="rect"></a>This definition implies that values of VR of TM, DA and DT are matched by their meaning, not as literal strings. For example:</p>
                           <div class="itemizedlist">
                              <ul class="itemizedlist" style="list-style-type: disc; ">
                                 <li class="listitem">
                                    <p>
                                       <a id="para_7c36b747-6955-4636-8d51-d7fc071cb3fa" shape="rect"></a>the DT "19980128103000.0000" matches "19980128103000"</p>
                                 </li>
                                 <li class="listitem">
                                    <p>
                                       <a id="para_9e508915-94ce-4181-8969-27d0cbc0389c" shape="rect"></a>the DT "19980128103000" with no timezone offset matches "19980128073000" with timezone offset "-0300"</p>
                                 </li>
                                 <li class="listitem">
                                    <p>
                                       <a id="para_7587f5c9-0324-4b3f-a5f0-494e866e95f3" shape="rect"></a>the TM "2230" matches "223000"</p>
                                 </li>
                              </ul>
                           </div>
                        </li>
                        <li class="listitem">
                           <p>
                              <a id="para_b64e19da-73ce-4072-b6a9-71c1197ae221" shape="rect"></a>If an application is concerned about how Single Value Matching of dates and times is performed by another application, it may consider using Range Matching instead, which is always performed by meaning, with both values in the range the same.</p>
                        </li>
                        <li class="listitem">
                           <p>
                              <a id="para_8ad311db-b04e-423f-9e0a-6418187c2d1c" shape="rect"></a>Exclusion of the "-" character for Single Value Matching implies that a Key Attribute with a VR of DT may not contain a negative offset from Universal Coordinated Time (UTC) if Single Value Matching is intended. Use of the "-" character in values of VR of TM, DA and DT indicates Range Matching.</p>
                        </li>
                        <li class="listitem">
                           <p>
                              <a id="para_52197e93-7a88-48cc-bb1e-e7535201bafc" shape="rect"></a>If an application is in a local time zone that has a negative offset then it cannot perform Single Value Matching using a local time notation. Instead, it can convert the Key Attribute Value to UTC and use an explicit suffix of "+0000".</p>
                        </li>
                     </ol>
                  </div>
               </div>
            </div>
            <div class="section">
               <div class="titlepage">
                  <div>
                     <div>
                        <h6 class="title">
                           <a id="sect_C.2.2.2.1.4" shape="rect"></a>C.2.2.2.1.4 Attributes of VR of DS or IS</h6>
                     </div>
                  </div>
               </div>
               <p>
                  <a id="para_066b5748-49dc-49c3-81ff-7d50295d9469" shape="rect"></a>The DS and IS VRs encode numbers as character strings.
                                The same number can be encoded differently when using character strings.
                                Therefore, the manner in which matching is performed is implementation dependent and shall be specified in the Conformance Statement.</p>
               <div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">
                  <h3 class="title">Note</h3>
                  <p>
                     <a id="para_d5e935d8-7ab9-43a7-9892-6d2b835ecfc7" shape="rect"></a>For example, depending on the SCP implementation, the IS values "+7" and "007" may or may not match the value "7".</p>
               </div>
            </div>
         </div>
      </div>
      <div class="navfooter">
         <hr />
         <table width="100%" summary="Navigation footer">
            <tr>
               <td width="40%" align="left" rowspan="1" colspan="1">
                  <a accesskey="p" href="sect_C.2.2.html" shape="rect">Prev</a> </td>
               <td width="20%" align="center" rowspan="1" colspan="1">
                  <a accesskey="u" href="sect_C.2.2.html" shape="rect">Up</a>
               </td>
               <td width="40%" align="right" rowspan="1" colspan="1"> <a accesskey="n" href="sect_C.2.2.2.2.html" shape="rect">Next</a>
               </td>
            </tr>
            <tr>
               <td width="40%" align="left" valign="top" rowspan="1" colspan="1">C.2.2 Attributes Definition </td>
               <td width="20%" align="center" rowspan="1" colspan="1">
                  <a accesskey="h" href="PS3.4.html" shape="rect">Home</a>
               </td>
               <td width="40%" align="right" valign="top" rowspan="1" colspan="1"> C.2.2.2.2 List of UID Matching</td>
            </tr>
         </table>
      </div>
      <table xmlns="" xmlns:d="http://docbook.org/ns/docbook" width="100%">
         <tr>
            <th colspan="1" align="center" rowspan="1">
               <span class="documentreleaseinformation">DICOM PS3.4 2024b - Service Class Specifications</span>
            </th>
         </tr>
      </table>
   </body>
</html>

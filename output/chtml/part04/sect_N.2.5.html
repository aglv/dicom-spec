<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
      <title>N.2.5 Angiography Grayscale Transformations</title>
      <link rel="stylesheet" type="text/css" href="dicom.css" />
      <meta name="generator" content="DocBook XSL Stylesheets V1.78.1" />
      <link rel="home" href="PS3.4.html" title="PS3.4" />
      <link rel="up" href="sect_N.2.html" title="N.2 Pixel Transformation Sequence" />
      <link rel="prev" href="sect_N.2.4.4.html" title="N.2.4.4 Conversion to Profile Connection Space" />
      <link rel="next" href="sect_N.2.5.2.html" title="N.2.5.2 Edge Enhancement" />
      <style type="text/css"><![CDATA[
	p { font-size: 15px; }
      ]]></style>
   </head>
   <body>
      <table xmlns="" xmlns:d="http://docbook.org/ns/docbook" width="100%">
         <tr>
            <th colspan="1" align="center" rowspan="1">
               <span class="documentreleaseinformation">DICOM PS3.4 2024a - Service Class Specifications</span>
            </th>
         </tr>
      </table>
      <div xmlns="" class="navheader">
         <table width="100%" summary="Navigation header">
            <tr>
               <th colspan="3" align="center" rowspan="1">N.2.5 Angiography Grayscale Transformations <a accesskey="current" href="http://dicom.nema.org/medical/dicom/current/output/chtml/part04/sect_N.2.5.html" shape="rect">(Current)</a>
               </th>
            </tr>
            <tr>
               <td width="20%" align="left" rowspan="1" colspan="1">
                  <a accesskey="p" href="sect_N.2.4.4.html" shape="rect">Prev</a> </td>
               <th width="60%" align="center" rowspan="1" colspan="1">N.2 Pixel Transformation Sequence</th>
               <td width="20%" align="right" rowspan="1" colspan="1"> <a accesskey="n" href="sect_N.2.5.2.html" shape="rect">Next</a>
               </td>
            </tr>
         </table>
         <hr />
      </div>
      <div xmlns="" xmlns:d="http://docbook.org/ns/docbook" class="breadcrumbs">
         <span class="breadcrumb-link">
            <a href="PS3.4.html" shape="rect">PS3.4</a>
         </span> &gt; <span class="breadcrumb-link">
            <a href="chapter_N.html" shape="rect">Softcopy Presentation State Storage SOP Classes (Normative)</a>
         </span> &gt; <span class="breadcrumb-link">
            <a href="sect_N.2.html" shape="rect">Pixel Transformation Sequence</a>
         </span> &gt; <span class="breadcrumb-node">Angiography Grayscale Transformations</span>
      </div>
      <div class="section">
         <div class="titlepage">
            <div>
               <div>
                  <h3 class="title">
                     <a id="sect_N.2.5" shape="rect"></a>N.2.5 Angiography Grayscale Transformations</h3>
               </div>
            </div>
         </div>
         <p>
            <a id="para_c007db5b-1ecb-49a4-8e51-97009f2170de" shape="rect"></a>The XA/XRF Grayscale Softcopy Presentation State Storage SOP Class supports a sequence of transformations that completely define the conversion of a stored image into a displayed image.</p>
         <p>
            <a id="para_f6c441bc-87e9-4717-ab4e-5d65ac219131" shape="rect"></a>The sequence of transformations from stored pixel values into P-Values is explicitly defined in a conceptual model. The actual sequence implemented may differ but must result in the same appearance. <a class="xref" href="sect_N.2.5.html#figure_N.2.5-1" title="Figure N.2.5-1. XA/XRF Grayscale Image Transformation Model" shape="rect">Figure N.2.5-1</a> describes this sequence of transformations.</p>
         <p>
            <a id="para_36f14de9-1312-4a36-b7c7-88dbbe79e009" shape="rect"></a>
                    </p>
         <div class="figure">
            <a id="figure_N.2.5-1" shape="rect"></a>
            <div class="figure-contents">
               <div class="mediaobject">
                  <img src="figures/PS3.4_N.2.5-1.svg" alt="XA/XRF Grayscale Image Transformation Model" />
               </div>
            </div>
            <p class="title">
               <strong>Figure N.2.5-1. XA/XRF Grayscale Image Transformation Model</strong>
            </p>
         </div>
         <p>
            <br class="figure-break" clear="none" />
                </p>
         <div class="section">
            <div class="titlepage">
               <div>
                  <div>
                     <h4 class="title">
                        <a id="sect_N.2.5.1" shape="rect"></a>N.2.5.1 Mask</h4>
                  </div>
               </div>
            </div>
            <p>
               <a id="para_2e658a9f-65f5-4219-8335-7bb5f106c86b" shape="rect"></a>The Mask transformation consists of mask subtraction operations as specified by the Attributes of the XA/XRF Presentation State Mask Module and the Attribute Mask Visibility Percentage of the XA/XRF Presentation State Presentation Module.</p>
            <p>
               <a id="para_46f62697-212c-4540-8b41-31238c16eb7d" shape="rect"></a>The mask transformation may be applied in the case of multi-frame images for which other frames at a fixed frame position or time interval relative to the current frame may be subtracted from the current frame. Multiple mask frames may be averaged, and sub-pixel shifted before subtraction. Sub-pixel shift may be specified on a frame-by-frame base. Different pixel-shifts may be applied to more than one region of a contrast frame.</p>
            <p>
               <a id="para_4fcc7285-1f5d-4a11-bd62-b1b1892c55dc" shape="rect"></a>In the case of X-Ray images, the subtraction is specified to take place in a space logarithmic to X-Ray intensity. If the stored pixel values are not in a logarithmic space then a Pixel Intensity Relationship LUT shall be present in the XA/XRF Presentation Mask Module specifying a transformation into such a logarithmic space, otherwise it shall not be present. If a Modality LUT or Pixel Intensity Relationship LUT is present in the referenced image(s) it shall be ignored. The Pixel Intensity Relationship LUT can be specified on a frame-by frame base that can be different for mask and contrast frames.</p>
            <div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">
               <h3 class="title">Note</h3>
               <div class="orderedlist">
                  <ol class="orderedlist" type="1">
                     <li class="listitem">
                        <p>
                           <a id="para_8dbe65fc-bf28-486c-8a54-1317c4573eb4" shape="rect"></a>For images of the X-Ray Angiographic Image Storage SOP Class or X-Ray RF Image Storage SOP Class the XA/XRF Grayscale Softcopy Presentation State allows a Pixel Intensity Relationship LUT to be specified on a frame-by-frame base. This is an enhancement of the image Modality LUT that is only applicable for all frames of an image.</p>
                     </li>
                     <li class="listitem">
                        <p>
                           <a id="para_2b429970-800d-44de-bac8-e66ae496c68f" shape="rect"></a>In the case of an XA or XRF image, if the Pixel Intensity Relationship (0028,1040) in the image is LOG, then even though a Modality LUT would be present in the image (to map pixel values back to linear X-Ray intensity), no Pixel Intensity Relationship LUT would be present in the presentation state for any frame since log values are required for subtraction. See <a href="../part03/sect_C.8.7.html#sect_C.8.7.1.1.2" class="olink" shape="rect">Section C.8.7.1.1.2 “Pixel Intensity Relationship” in <span class="olinkdocname">PS3.3</span>
                           </a>.</p>
                        <p>
                           <a id="para_1b85f4cd-3cf5-40a2-95f9-e78bd07b8ab0" shape="rect"></a>In the case of Enhanced XA or XRF image, if the Pixel Intensity Relationship (0028,1040) in the frame is LOG, then even though a Pixel Intensity Relationship LUT would be present in the frame (to map pixel values back to linear X-Ray intensity, LUT Function (0028,9474) equals TO_LINEAR), no Pixel Intensity Relationship LUT would be present in the presentation state for that frame since log values are required for subtraction. See <a href="../part03/sect_C.7.6.16.2.html#sect_C.7.6.16.2.13" class="olink" shape="rect">Section C.7.6.16.2.13 “Pixel Intensity Relationship LUT Macro” in <span class="olinkdocname">PS3.3</span>
                           </a>.</p>
                     </li>
                     <li class="listitem">
                        <p>
                           <a id="para_b9c07f12-31fa-4617-ad90-f0767eaab4da" shape="rect"></a>In the case of an XA or XRF image if the Pixel Intensity Relationship (0028,1040) in the image is LIN, then no Modality LUT would be present in the image, but a Pixel Intensity Relationship LUT would need to be present (to map pixel values to log values, LUT Function (0028,9474) equals TO_LOG) in the presentation state for all the frames since log values are required for subtraction.</p>
                        <p>
                           <a id="para_f4f0ffab-1afb-4b72-bb1f-060aa75f82be" shape="rect"></a>In the case of an Enhanced XA or XRF image, if the Pixel Intensity Relationship (0028,1040) in the frame is LIN, then no Pixel Intensity Relationship LUT for the purpose to map pixel values back to linear X-Ray intensity (LUT Function (0028,9474) equals TO_LINEAR) would be present in the image, but a Pixel Intensity Relationship LUT would need to be present (to map pixel values to log values) in the presentation state for that frame since log values are required for subtraction.</p>
                     </li>
                     <li class="listitem">
                        <p>
                           <a id="para_57137874-5ec4-40e2-81a7-5f98ebfd672b" shape="rect"></a>In the case of an XA or XRF image, if the Pixel Intensity Relationship (0028,1040) in the image is DISP, then even though a Modality LUT may or may not be present in the image (to map pixel values back to linear to X-Ray intensity), a different Pixel Intensity Relationship LUT would be present in the presentation state if the creator of the presentation state could create a transformation from DISP pixel values to a logarithmic space for subtraction, or the Pixel Intensity Relationship LUT in the presentation state would be an identity transformation if the DISP pixel values were known to already be log values required for subtraction.</p>
                        <p>
                           <a id="para_52f7a5f2-cc5e-45a4-8c27-cd0c88906325" shape="rect"></a>In the case of an Enhanced XA or XRF image, if the Pixel Intensity Relationship (0028,1040) in the image is OTHER, then even though a Pixel Intensity Relationship LUT may or may not be present for that frame (to map pixel values back to linear to X-Ray intensity), a different Pixel Intensity Relationship LUT would be present in the presentation state for that frame if the creator of the presentation state could create a transformation from OTHER pixel values to a logarithmic space for subtraction, or the Pixel Intensity Relationship LUT in the presentation state would be an identity transformation if the OTHER pixel values were known to already be log values required for subtraction.</p>
                     </li>
                     <li class="listitem">
                        <p>
                           <a id="para_b8ffa6fc-60e5-4918-93d5-81e917f5ea94" shape="rect"></a>Notes 2, 3 and 4 are summarized in <a class="xref" href="sect_N.2.5.html#table_N.2.5.1-1" title="Table N.2.5.1-1. Summary of Providing a LUT Function for Subtraction" shape="rect">Table N.2.5.1-1</a>
                                </p>
                     </li>
                  </ol>
               </div>
               <div class="table">
                  <a id="table_N.2.5.1-1" shape="rect"></a>
                  <p class="title">
                     <strong>Table N.2.5.1-1. Summary of Providing a LUT Function for Subtraction</strong>
                  </p>
                  <div class="table-contents">
                     <table frame="box" rules="all">
                        <thead>
                           <tr valign="top">
                              <th align="center" rowspan="1" colspan="1">
                                        <p>
                                    <a id="para_d5d401c2-2716-40f2-a856-666f171a2d13" shape="rect"></a>Pixel Intensity Relationship (0028,1040) Attribute of the referenced SOP Instance</p>
                                    </th>
                              <th align="center" rowspan="1" colspan="1">
                                        <p>
                                    <a id="para_57914ed4-c3ab-4599-82e7-0479fbeddc29" shape="rect"></a>The contents of Pixel Intensity Relationship LUT Sequence (0028,9422) in XA/XRF Presentation State Mask Module</p>
                                    </th>
                           </tr>
                        </thead>
                        <tbody>
                           <tr valign="top">
                              <td align="left" rowspan="1" colspan="1">
                                        <p>
                                    <a id="para_b80e6417-57dc-478c-9439-66cc94f861df" shape="rect"></a>LIN</p>
                                    </td>
                              <td align="left" rowspan="1" colspan="1">
                                        <p>
                                    <a id="para_4aa95912-12e3-4a17-97d5-262befe426fa" shape="rect"></a>TO_LOG LUT provided</p>
                                    </td>
                           </tr>
                           <tr valign="top">
                              <td align="left" rowspan="1" colspan="1">
                                        <p>
                                    <a id="para_6ab34292-59f1-4991-a1d1-30715c81edc8" shape="rect"></a>LOG</p>
                                    </td>
                              <td align="left" rowspan="1" colspan="1">
                                        <p>
                                    <a id="para_79a0b6ba-5617-46c0-a050-c6e788c63657" shape="rect"></a>absent</p>
                                    </td>
                           </tr>
                           <tr valign="top">
                              <td align="left" rowspan="1" colspan="1">
                                        <p>
                                    <a id="para_dc708c44-42ef-410c-91b2-5b43d9e7247f" shape="rect"></a>DISP or OTHER</p>
                                    </td>
                              <td align="left" rowspan="1" colspan="1">
                                        <p>
                                    <a id="para_797e63ee-be70-48ed-8ae5-49e7089d648c" shape="rect"></a>TO_LOG LUT provided, may be an identity</p>
                                    </td>
                           </tr>
                        </tbody>
                     </table>
                  </div>
               </div>
               <br class="table-break" clear="none" />
            </div>
         </div>
      </div>
      <div class="navfooter">
         <hr />
         <table width="100%" summary="Navigation footer">
            <tr>
               <td width="40%" align="left" rowspan="1" colspan="1">
                  <a accesskey="p" href="sect_N.2.4.4.html" shape="rect">Prev</a> </td>
               <td width="20%" align="center" rowspan="1" colspan="1">
                  <a accesskey="u" href="sect_N.2.html" shape="rect">Up</a>
               </td>
               <td width="40%" align="right" rowspan="1" colspan="1"> <a accesskey="n" href="sect_N.2.5.2.html" shape="rect">Next</a>
               </td>
            </tr>
            <tr>
               <td width="40%" align="left" valign="top" rowspan="1" colspan="1">N.2.4.4 Conversion to Profile Connection Space </td>
               <td width="20%" align="center" rowspan="1" colspan="1">
                  <a accesskey="h" href="PS3.4.html" shape="rect">Home</a>
               </td>
               <td width="40%" align="right" valign="top" rowspan="1" colspan="1"> N.2.5.2 Edge Enhancement</td>
            </tr>
         </table>
      </div>
      <table xmlns="" xmlns:d="http://docbook.org/ns/docbook" width="100%">
         <tr>
            <th colspan="1" align="center" rowspan="1">
               <span class="documentreleaseinformation">DICOM PS3.4 2024a - Service Class Specifications</span>
            </th>
         </tr>
      </table>
   </body>
</html>

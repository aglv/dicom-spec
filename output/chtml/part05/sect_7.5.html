<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
      <title>7.5 Nesting of Data Sets</title>
      <link rel="stylesheet" type="text/css" href="dicom.css" />
      <meta name="generator" content="DocBook XSL Stylesheets V1.78.1" />
      <link rel="home" href="PS3.5.html" title="PS3.5" />
      <link rel="up" href="chapter_7.html" title="7 The Data Set" />
      <link rel="prev" href="sect_7.4.6.html" title="7.4.6 Data Element Types Within A Sequence" />
      <link rel="next" href="sect_7.5.2.html" title="7.5.2 Delimitation of The Sequence of Items" />
      <style type="text/css"><![CDATA[
	p { font-size: 15px; }
      ]]></style>
   </head>
   <body>
      <table xmlns="" xmlns:d="http://docbook.org/ns/docbook" width="100%">
         <tr>
            <th colspan="1" align="center" rowspan="1">
               <span class="documentreleaseinformation">DICOM PS3.5 - Data Structures and Encoding</span>
            </th>
         </tr>
      </table>
      <div xmlns="" class="navheader">
         <table width="100%" summary="Navigation header">
            <tr>
               <th colspan="3" align="center" rowspan="1">7.5 Nesting of Data Sets <a accesskey="current" href="http://dicom.nema.org/medical/dicom/current/output/chtml/part05/sect_7.5.html" shape="rect">(Current)</a>
               </th>
            </tr>
            <tr>
               <td width="20%" align="left" rowspan="1" colspan="1">
                  <a accesskey="p" href="sect_7.4.6.html" shape="rect">Prev</a> </td>
               <th width="60%" align="center" rowspan="1" colspan="1">7 The Data Set</th>
               <td width="20%" align="right" rowspan="1" colspan="1"> <a accesskey="n" href="sect_7.5.2.html" shape="rect">Next</a>
               </td>
            </tr>
         </table>
         <hr />
      </div>
      <div xmlns="" xmlns:d="http://docbook.org/ns/docbook" class="breadcrumbs">
         <span class="breadcrumb-link">
            <a href="PS3.5.html" shape="rect">PS3.5</a>
         </span> &gt; <span class="breadcrumb-link">
            <a href="chapter_7.html" shape="rect">The Data Set</a>
         </span> &gt; <span class="breadcrumb-node">Nesting of Data Sets</span>
      </div>
      <div class="section">
         <div class="titlepage">
            <div>
               <div>
                  <h2 class="title" style="clear: both">
                     <a id="sect_7.5" shape="rect"></a>7.5 Nesting of Data Sets</h2>
               </div>
            </div>
         </div>
         <p>
            <a id="para_83126a80-ad4d-4703-9af2-11421a1f7cbd" shape="rect"></a>The VR identified "SQ" shall be used for Data Elements with a Value consisting of a Sequence of zero or more Items, where each Item contains a set of Data Elements. SQ provides a flexible encoding scheme that may be used for simple structures of repeating sets of Data Elements, or the encoding of more complex Information Object Definitions often called folders. SQ Data Elements can also be used recursively to contain multi-level nested structures.</p>
         <p>
            <a id="para_5eb1b6ed-5c94-42f9-9ca2-687de6182852" shape="rect"></a>Items present in an SQ Data Element shall be an ordered set where each Item may be referenced by its ordinal position. Each Item shall be implicitly assigned an ordinal position starting with the Value 1 for the first Item in the Sequence, and incremented by 1 with each subsequent Item. The last Item in the Sequence shall have an ordinal position equal to the number of Items in the Sequence.</p>
         <div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">
            <h3 class="title">Note</h3>
            <div class="orderedlist">
               <ol class="orderedlist" type="1">
                  <li class="listitem">
                     <p>
                        <a id="para_2ae69670-9478-4916-a024-a1bd896bb28e" shape="rect"></a>This clause implies that item ordering is preserved during transfer and storage.</p>
                  </li>
                  <li class="listitem">
                     <p>
                        <a id="para_4115116c-8cda-4c81-abcd-11fc553f49c9" shape="rect"></a>An IOD or Module Definition may choose to not use this ordering property of a Data Element with VR of SQ. This is simply done by not specifying any specific semantics to the ordering of Items, or by not specifying usage of the referencing of Items by ordering position.</p>
                  </li>
               </ol>
            </div>
         </div>
         <p>
            <a id="para_dbc1ea0b-51eb-46b4-8406-df7dbd3835e1" shape="rect"></a>The definition of the Data Elements encapsulated in each Item is provided by the specification of the Data Element (or associated Attribute) of Value Representation SQ. Items in a sequence of Items may or may not contain the same set of Data Elements. Data Elements with a VR of SQ may contain multiple Items but shall always have a Value Multiplicity of one (i.e., a single Sequence).</p>
         <p>
            <a id="para_4643cded-f020-4e76-901a-83c2eb6b7a9a" shape="rect"></a>There are three special SQ related Data Elements that are not ruled by the VR encoding rules conveyed by the Transfer Syntax. They shall be encoded as Implicit VR. These special Data Elements are Item (FFFE,E000), Item Delimitation Item (FFFE,E00D), and Sequence Delimitation Item (FFFE,E0DD). However, the Data Set within the Value Field of the Data Element Item (FFFE,E000) shall be encoded according to the rules conveyed by the Transfer Syntax.</p>
         <div class="section">
            <div class="titlepage">
               <div>
                  <div>
                     <h3 class="title">
                        <a id="sect_7.5.1" shape="rect"></a>7.5.1 Item Encoding Rules</h3>
                  </div>
               </div>
            </div>
            <p>
               <a id="para_ebb6e151-5f57-4a4c-865d-afac14607362" shape="rect"></a>Each Item of a Data Element of Value Representation SQ shall be encoded as a DICOM Standard Data Element with a specific Data Element Tag of Value (FFFE,E000). The Item Tag is followed by a 4 byte Value (Item) Length field encoded in one of the following two ways:</p>
            <div class="orderedlist">
               <ol class="orderedlist" type="a">
                  <li class="listitem">
                     <p>
                        <a id="para_773b45e5-967a-46d2-944d-4fef13dc1372" shape="rect"></a>Explicit Length: The number of bytes (even) contained in the Sequence Item Value (following but not including the Value (Item) Length Field) is encoded as a 32-bit unsigned integer value (see <a class="xref" href="chapter_7.html#sect_7.1" title="7.1 Data Elements" shape="rect">Section 7.1</a>). This length shall include the total length of all Data Elements conveyed by this Item. This Value (Item) Length Field shall be equal to 00000000H if the Item contains no Data Set.</p>
                  </li>
                  <li class="listitem">
                     <p>
                        <a id="para_c9852304-9a83-4617-af88-187cf2b7dbce" shape="rect"></a>Undefined Length: The Value (Item) Length Field shall contain the value FFFFFFFFH to indicate an Undefined Length. It shall be used in conjunction with an Item Delimitation Data Element. This Item Delimitation Data Element has a Data Element Tag of (FFFE,E00D) and shall follow the Data Elements encapsulated in the Item. No Value shall be present in the Item Delimitation Data Element and its Value (Item) Length shall be 00000000H. An Item containing no Data Set is encoded by an Item Delimitation Data Element only.</p>
                  </li>
               </ol>
            </div>
            <p>
               <a id="para_4cf9889b-55ba-4cf5-9eff-92a64787a0a6" shape="rect"></a>The encoder of a Data Set may choose either one of the two ways of encoding. Both ways of encoding shall be supported by decoders of Data Sets. Data Element Tags (FFFF,eeee) are reserved by this Standard and shall not be used.</p>
            <p>
               <a id="para_2f85d469-aaf7-4095-9790-94da1fc5eba7" shape="rect"></a>Each Item Value shall contain a DICOM Data Set composed of Data Elements. Within the context of each Item, these Data Elements shall be ordered by increasing Data Element Tag value and appear only once (as Data Set is defined in <a class="xref" href="chapter_7.html#sect_7.1" title="7.1 Data Elements" shape="rect">Section 7.1</a>). There is no relationship between the ordering of the Data Elements contained within an Item and the ordering of the Data Element Tag of SQ Value Representation that contains that Item. One or more Data Elements in an Item may be of Value Representation SQ, thus allowing for recursion.</p>
            <p>
               <a id="para_d5422833-4cdb-4e1f-a440-5197eb52743d" shape="rect"></a>Data Elements with a group of 0000, 0002 and 0006 shall not be present within Sequence Items.</p>
            <div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">
               <h3 class="title">Note</h3>
               <p>
                  <a id="para_f0d1f7a6-74e6-4da3-a836-5bf4bea01d2b" shape="rect"></a>The use of Transfer Syntax UID (0002,0010) in particular is forbidden, since were it to differ from the Transfer Syntax of the enclosing Data Set then a change in encoding would be implied, which is not allowed.</p>
            </div>
            <p>
               <a id="para_401ef594-c38a-40f8-b23f-34f5b13c41ac" shape="rect"></a>
               <a class="xref" href="sect_7.8.html" title="7.8 Private Data Elements" shape="rect">Section 7.8</a> specifies rules for incorporating Private Data Elements into Sequence Items.</p>
         </div>
      </div>
      <div class="navfooter">
         <hr />
         <table width="100%" summary="Navigation footer">
            <tr>
               <td width="40%" align="left" rowspan="1" colspan="1">
                  <a accesskey="p" href="sect_7.4.6.html" shape="rect">Prev</a> </td>
               <td width="20%" align="center" rowspan="1" colspan="1">
                  <a accesskey="u" href="chapter_7.html" shape="rect">Up</a>
               </td>
               <td width="40%" align="right" rowspan="1" colspan="1"> <a accesskey="n" href="sect_7.5.2.html" shape="rect">Next</a>
               </td>
            </tr>
            <tr>
               <td width="40%" align="left" valign="top" rowspan="1" colspan="1">7.4.6 Data Element Types Within A Sequence </td>
               <td width="20%" align="center" rowspan="1" colspan="1">
                  <a accesskey="h" href="PS3.5.html" shape="rect">Home</a>
               </td>
               <td width="40%" align="right" valign="top" rowspan="1" colspan="1"> 7.5.2 Delimitation of The Sequence of Items</td>
            </tr>
         </table>
      </div>
      <table xmlns="" xmlns:d="http://docbook.org/ns/docbook" width="100%">
         <tr>
            <th colspan="1" align="center" rowspan="1">
               <span class="documentreleaseinformation">DICOM PS3.5 - Data Structures and Encoding</span>
            </th>
         </tr>
      </table>
   </body>
</html>

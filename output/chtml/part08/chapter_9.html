<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
      <title>9 DICOM Upper Layer Protocol for TCP/IP</title>
      <link rel="stylesheet" type="text/css" href="dicom.css" />
      <meta name="generator" content="DocBook XSL Stylesheets V1.78.1" />
      <link rel="home" href="PS3.8.html" title="PS3.8" />
      <link rel="up" href="PS3.8.html" title="PS3.8" />
      <link rel="prev" href="chapter_8.html" title="8 DICOM OSI Upper Layer Profile" />
      <link rel="next" href="sect_9.2.html" title="9.2 DICOM Upper Layer Protocol for TCP/IP State Machine" />
      <style type="text/css"><![CDATA[
	p { font-size: 15px; }
      ]]></style>
   </head>
   <body>
      <table xmlns="" xmlns:d="http://docbook.org/ns/docbook" width="100%">
         <tr>
            <th colspan="1" align="center" rowspan="1">
               <span class="documentreleaseinformation">DICOM PS3.8 2024a - Network Communication Support for Message Exchange</span>
            </th>
         </tr>
      </table>
      <div xmlns="" class="navheader">
         <table width="100%" summary="Navigation header">
            <tr>
               <th colspan="3" align="center" rowspan="1">9 DICOM Upper Layer Protocol for TCP/IP <a accesskey="current" href="http://dicom.nema.org/medical/dicom/current/output/chtml/part08/chapter_9.html" shape="rect">(Current)</a>
               </th>
            </tr>
            <tr>
               <td width="20%" align="left" rowspan="1" colspan="1">
                  <a accesskey="p" href="chapter_8.html" shape="rect">Prev</a> </td>
               <th width="60%" align="center" rowspan="1" colspan="1"> </th>
               <td width="20%" align="right" rowspan="1" colspan="1"> <a accesskey="n" href="sect_9.2.html" shape="rect">Next</a>
               </td>
            </tr>
         </table>
         <hr />
      </div>
      <div xmlns="" xmlns:d="http://docbook.org/ns/docbook" class="breadcrumbs">
         <span class="breadcrumb-link">
            <a href="PS3.8.html" shape="rect">PS3.8</a>
         </span> &gt; <span class="breadcrumb-node">DICOM Upper Layer Protocol for TCP/IP</span>
      </div>
      <div class="chapter">
         <div class="titlepage">
            <div>
               <div>
                  <h1 class="title">
                     <a id="chapter_9" shape="rect"></a>9 DICOM Upper Layer Protocol for TCP/IP</h1>
               </div>
            </div>
         </div>
         <p>
            <a id="para_96dbfb6b-6f0b-4704-a8a5-c132c3605ce3" shape="rect"></a>The DICOM Upper Layer Protocol specified in this section shall be used in conjunction with the TCP/IP transport layers..</p>
         <div class="section">
            <div class="titlepage">
               <div>
                  <div>
                     <h2 class="title" style="clear: both">
                        <a id="sect_9.1" shape="rect"></a>9.1 Use of the Transport Service Provided By TCP</h2>
                  </div>
               </div>
            </div>
            <div class="section">
               <div class="titlepage">
                  <div>
                     <div>
                        <h3 class="title">
                           <a id="sect_9.1.1" shape="rect"></a>9.1.1 General</h3>
                     </div>
                  </div>
               </div>
               <p>
                  <a id="para_73116504-4780-435f-abe5-7e4b248b8df8" shape="rect"></a>There is a one-to-one relationship between a TCP Transport Connection and an Upper Layer Association. Therefore, the following rules apply:</p>
               <div class="orderedlist">
                  <ol class="orderedlist" type="a">
                     <li class="listitem">
                        <p>
                           <a id="para_aa941272-d494-4927-9af1-34430263ff91" shape="rect"></a>Each Upper Layer Association shall be supported by one and only one TCP Transport Connection.</p>
                     </li>
                     <li class="listitem">
                        <p>
                           <a id="para_2ffcae86-8611-4489-8ca5-ef7e8d8418eb" shape="rect"></a>Each TCP Transport Connection shall support one and only one Upper Layer Association.</p>
                     </li>
                  </ol>
               </div>
               <p>
                  <a id="para_8f386c3e-3c37-4327-b3f7-d6da2b0e85db" shape="rect"></a>The Services provided by the TCP Transport Services are not formally documented. This section, therefore, makes use of "commonly" used terms in a number of TCP Programming Interface Implementations (e.g., Sockets). However, the following RFCs shall be required for TCP/IP support. They specify the support needed for IPv4.</p>
               <div class="orderedlist">
                  <ol class="orderedlist" type="a">
                     <li class="listitem">
                        <p>
                           <a id="para_1c951781-e9cb-4a87-a333-ade47b5c1fc5" shape="rect"></a>RFC793, Transmission Control Program - DARPA Internet Protocol Specification</p>
                     </li>
                     <li class="listitem">
                        <p>
                           <a id="para_b7967a71-b1d4-4375-98bc-d87f86e9d14c" shape="rect"></a>RFC791, Internet Protocol - DARPA Internet Protocol Specification</p>
                     </li>
                     <li class="listitem">
                        <p>
                           <a id="para_3da3d11f-ad88-4697-bc07-048c531158f4" shape="rect"></a>RFC792, Internet Control Message Protocol - DARPA Internet Program Protocol Specification</p>
                     </li>
                     <li class="listitem">
                        <p>
                           <a id="para_95f7fe3a-170d-4a76-aabd-5231dbe74595" shape="rect"></a>RFC950, Internet Subnetting</p>
                     </li>
                  </ol>
               </div>
               <p>
                  <a id="para_9958dafb-f3dc-44c1-b10b-ee99e1f90e8f" shape="rect"></a>In addition, devices that support IPv6 shall comply with:</p>
               <div class="orderedlist">
                  <ol class="orderedlist" type="a">
                     <li class="listitem">
                        <p>
                           <a id="para_8c337665-1906-4b87-9ca6-6ca1b044eb8d" shape="rect"></a>RFC1881, IPv6 Address Allocation Management</p>
                     </li>
                     <li class="listitem">
                        <p>
                           <a id="para_f0acf3ef-634a-4999-9e53-14279912e60e" shape="rect"></a>RFC2460, Internet Protocol, Version 6 (IPv6) Specification</p>
                     </li>
                  </ol>
               </div>
               <div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">
                  <h3 class="title">Note</h3>
                  <p>
                     <a id="para_937709e4-1862-4723-89eb-62fef596230f" shape="rect"></a>There are many other RFC's that may also apply to a particular implementation depending upon specific selections of hardware and software features.</p>
               </div>
               <p>
                  <a id="para_cc9e13e4-a40d-4f8c-ab65-1d7e8d1de419" shape="rect"></a>For the establishment of a TCP connection, a TCP port shall be used to serve as the transport selector. A DICOM UL entity is identified on a given system on the network by a port number unique within the scope of this system. Port numbers of remote DICOM UL entities (well known port number or other numbers) shall be configurable on DICOM UL entities.</p>
               <div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">
                  <h3 class="title">Note</h3>
                  <p>
                     <a id="para_6ff73449-964d-4ac2-8cb4-30064cbdc668" shape="rect"></a>It is strongly recommended that systems supporting a single DICOM UL entity use as their port the "well known port" registered for the DICOM Upper Layer Protocol: port number 104 (decimal), if the operating system permits access to privileged ports (in the range 0 to 1023), otherwise it is recommended that they use the "registered" port number 11112 (decimal). See "http://www.iana.org/assignments/port-numbers".</p>
               </div>
               <p>
                  <a id="para_71698faf-a264-4672-b4c8-9568fae3d0e8" shape="rect"></a>Application Entities may also choose to access the TCP Transport Services via a Secure Transport Connection. The nature of this Secure Transport Connection is specified through Security Profiles (see <a href="../part15/PS3.15.html" class="olink" shape="rect">PS3.15</a>). Security Profiles select minimum mechanisms needed to support that profile. Other mechanisms may also be used if agreed to during establishment of the Secure Transport Connection.</p>
               <div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">
                  <h3 class="title">Note</h3>
                  <div class="orderedlist">
                     <ol class="orderedlist" type="1">
                        <li class="listitem">
                           <p>
                              <a id="para_06495a66-b151-42ec-8a8f-289caf81ce59" shape="rect"></a>DICOM does not specify how a secure transport connection is established, or the significance of any certificates exchanged during peer entity authentication. These issues are left up to the application, which is assumed to be following some security policy. Once the application has established a secure Transport Connection, then an Upper Layer Association can use that secure channel.</p>
                        </li>
                        <li class="listitem">
                           <p>
                              <a id="para_15df8510-64e6-41b1-936e-0cf47938a008" shape="rect"></a>There may be an interaction between PDU size and record size of the secure Transport Connection that impacts efficiency of transport.</p>
                        </li>
                        <li class="listitem">
                           <p>
                              <a id="para_f8c10282-9137-4d25-8c91-a423eaa53e6b" shape="rect"></a>Registered ports for Secure Transport Connections are defined in <a href="../part15/PS3.15.html" class="olink" shape="rect">PS3.15</a>.</p>
                        </li>
                     </ol>
                  </div>
               </div>
            </div>
            <div class="section">
               <div class="titlepage">
                  <div>
                     <div>
                        <h3 class="title">
                           <a id="sect_9.1.2" shape="rect"></a>9.1.2 Opening a TCP Transport Connection</h3>
                     </div>
                  </div>
               </div>
               <p>
                  <a id="para_a5e5a5d8-7aa5-4fd0-8c98-f96ac0987692" shape="rect"></a>When an Association is to be established by a DICOM Upper Layer Entity, a TRANSPORT CONNECT request primitive shall be issued to the TCP Transport Service (Active Open). Once the TCP Transport Connection Confirmation is received (Open Completed), an A-ASSOCIATE-RQ PDU shall be sent/written on the now established transport connection.</p>
               <p>
                  <a id="para_ef016447-9bfb-4943-93a1-b17f8ba93489" shape="rect"></a>When a DICOM Upper Layer Entity becomes activated (Association Idle State), it shall wait for TCP Transport Connections in a passive mode by initiating a "listen". When an incoming TCP Transport Connection Indication is received from the network, it is accepted and a timer ARTIM (Association Request/Reject/Release Timer) shall be set. Any further exchange of PDUs (read/write) shall be performed as specified by the Upper Layer State Machine (including ARTIM Timer expiration before an A-ASSOCIATE-RQ PDU is received, see <a class="xref" href="sect_9.2.html" title="9.2 DICOM Upper Layer Protocol for TCP/IP State Machine" shape="rect">Section 9.2</a>).</p>
            </div>
            <div class="section">
               <div class="titlepage">
                  <div>
                     <div>
                        <h3 class="title">
                           <a id="sect_9.1.3" shape="rect"></a>9.1.3 Transferring Data On a TCP Connection</h3>
                     </div>
                  </div>
               </div>
               <p>
                  <a id="para_4dd9466b-8c28-44dc-a563-b927b048db73" shape="rect"></a>Data exchange of PDUs (read/write) on an established TCP Connection shall follow the specifications of the DICOM Upper Layer Protocol State Machine (see <a class="xref" href="sect_9.2.html" title="9.2 DICOM Upper Layer Protocol for TCP/IP State Machine" shape="rect">Section 9.2</a>) and the DICOM Upper Layer PDU structure (see <a class="xref" href="sect_9.3.html" title="9.3 DICOM Upper Layer Protocol for TCP/IP Data Units Structure" shape="rect">Section 9.3</a>).</p>
            </div>
            <div class="section">
               <div class="titlepage">
                  <div>
                     <div>
                        <h3 class="title">
                           <a id="sect_9.1.4" shape="rect"></a>9.1.4 Closing a TCP Transport Connection</h3>
                     </div>
                  </div>
               </div>
               <p>
                  <a id="para_a02d55ef-64a3-4b42-b112-e10d70ab336b" shape="rect"></a>TCP Transport Connections shall be closed using the "don't linger" option.</p>
               <p>
                  <a id="para_2011fe6f-9b1f-46a1-b736-9f2f7c620e23" shape="rect"></a>A TCP Transport Connection is closed under a number of situations. These are described in the DICOM Upper Layer Protocol State Machine. Some typical cases are discussed below:</p>
               <div class="orderedlist">
                  <ol class="orderedlist" type="a">
                     <li class="listitem">
                        <p>
                           <a id="para_8b2d8712-2a66-4011-9e1d-72dc58ca0e75" shape="rect"></a>After an A-RELEASE-RQ has been sent and the A-RELEASE-RP PDU is received</p>
                     </li>
                     <li class="listitem">
                        <p>
                           <a id="para_4a0cc4ac-f7d7-4394-bc21-6f775cc9aa96" shape="rect"></a>When a Transport Connection has been established by the DICOM remote UL Entity and no A-ASSOCIATE-RQ is received before the ARTIM Timer expires</p>
                     </li>
                     <li class="listitem">
                        <p>
                           <a id="para_2bd49896-9ae3-4b6a-ae74-2565d5e87bb2" shape="rect"></a>When an A-ABORT PDU has been received</p>
                     </li>
                     <li class="listitem">
                        <p>
                           <a id="para_b22ecdf5-2278-4671-97a3-3efd7746dbd3" shape="rect"></a>When an A-ABORT PDU has been sent and the ARTIM Timer expires before the Transport Connection is closed</p>
                     </li>
                     <li class="listitem">
                        <p>
                           <a id="para_3eeb327e-3928-47a3-8bda-35b74aa91444" shape="rect"></a>When a TCP connection is being disconnected by the Transport Service Provider (e.g., network failure)</p>
                     </li>
                     <li class="listitem">
                        <p>
                           <a id="para_10d500d1-3493-43fe-bbfb-f45524cac499" shape="rect"></a>When a TCP connection is being disconnected by the remote DICOM UL Entity</p>
                     </li>
                  </ol>
               </div>
               <div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">
                  <h3 class="title">Note</h3>
                  <div class="orderedlist">
                     <ol class="orderedlist" type="1">
                        <li class="listitem">
                           <p>
                              <a id="para_e63366a2-e96b-4af9-b4b6-63c91f8664d1" shape="rect"></a>Except following the normal completion of an association reject, release or abort and in specific situations such as temporary lack of resources, an Upper Layer State Machine should not disconnect a TCP connection or reject its establishment. The appropriate behavior is to use the Association Reject or Abort services.</p>
                        </li>
                        <li class="listitem">
                           <p>
                              <a id="para_cc6e6903-95e6-4c55-8842-d03e0e30bd13" shape="rect"></a>The ARTIM Timer should not be used to oversee the Association Establishment or Release. Such a mechanism falls under the protocol definition of the layer above the DICOM Upper Layer (i.e., DICOM Application Entity, see <a href="../part07/PS3.7.html" class="olink" shape="rect">PS3.7</a>).</p>
                        </li>
                     </ol>
                  </div>
               </div>
            </div>
            <div class="section">
               <div class="titlepage">
                  <div>
                     <div>
                        <h3 class="title">
                           <a id="sect_9.1.5" shape="rect"></a>9.1.5 ARTIM Timer</h3>
                     </div>
                  </div>
               </div>
               <p>
                  <a id="para_f9121fd2-7876-4f1b-802e-a71a65267b8e" shape="rect"></a>The value of the ARTIM Timer used to manage the Request, Reject, and Release of associations on a DICOM UL entity shall be configurable to address a wide range of network configurations.</p>
            </div>
         </div>
      </div>
      <div class="navfooter">
         <hr />
         <table width="100%" summary="Navigation footer">
            <tr>
               <td width="40%" align="left" rowspan="1" colspan="1">
                  <a accesskey="p" href="chapter_8.html" shape="rect">Prev</a> </td>
               <td width="20%" align="center" rowspan="1" colspan="1"> </td>
               <td width="40%" align="right" rowspan="1" colspan="1"> <a accesskey="n" href="sect_9.2.html" shape="rect">Next</a>
               </td>
            </tr>
            <tr>
               <td width="40%" align="left" valign="top" rowspan="1" colspan="1">8 DICOM OSI Upper Layer Profile </td>
               <td width="20%" align="center" rowspan="1" colspan="1">
                  <a accesskey="h" href="PS3.8.html" shape="rect">Home</a>
               </td>
               <td width="40%" align="right" valign="top" rowspan="1" colspan="1"> 9.2 DICOM Upper Layer Protocol for TCP/IP State Machine</td>
            </tr>
         </table>
      </div>
      <table xmlns="" xmlns:d="http://docbook.org/ns/docbook" width="100%">
         <tr>
            <th colspan="1" align="center" rowspan="1">
               <span class="documentreleaseinformation">DICOM PS3.8 2024a - Network Communication Support for Message Exchange</span>
            </th>
         </tr>
      </table>
   </body>
</html>
